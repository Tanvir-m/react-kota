(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{kSMX:function(t,e,i){"use strict";var n=i("sXyB"),r=i("RIqP"),a=i("J4zp"),s=i("iWIM"),o=i("lwsE"),h=i("W8MJ"),u=i("PJYZ"),l=i("7W2i"),c=i("a1gu"),d=i("Nsbk"),v=i("oShl");function f(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=d(t);if(e){var r=d(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return c(this,i)}}function g(t){var e=t[0],i=t[1],n=t[2];return Math.sqrt(e*e+i*i+n*n)}function p(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function m(t,e,i,n){return t[0]=e,t[1]=i,t[2]=n,t}function y(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function w(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function x(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function b(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function M(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function A(t,e){var i=e[0],n=e[1],r=e[2],a=i*i+n*n+r*r;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t}function E(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}Object.defineProperty(e,"__esModule",{value:!0});var k,F,T=(k=[0,0,0],F=[0,0,0],function(t,e){p(k,t),p(F,e),A(k,k),A(F,F);var i=E(k,F);return i>1?0:i<-1?Math.PI:Math.acos(i)});var _=function(t){l(i,t);var e=f(i);function i(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n;return o(this,i),t=e.call(this,n,r,a),c(t,u(t))}return h(i,[{key:"x",get:function(){return this[0]},set:function(t){this[0]=t}},{key:"y",get:function(){return this[1]},set:function(t){this[1]=t}},{key:"z",get:function(){return this[2]},set:function(t){this[2]=t}},{key:"set",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t;return t.length?this.copy(t):(m(this,t,e,i),this)}},{key:"copy",value:function(t){return p(this,t),this}},{key:"add",value:function(t,e){return e?y(this,t,e):y(this,this,t),this}},{key:"sub",value:function(t,e){return e?w(this,t,e):w(this,this,t),this}},{key:"multiply",value:function(t){var e,i,n;return t.length?(i=this,n=t,(e=this)[0]=i[0]*n[0],e[1]=i[1]*n[1],e[2]=i[2]*n[2]):x(this,this,t),this}},{key:"divide",value:function(t){var e,i,n;return t.length?(i=this,n=t,(e=this)[0]=i[0]/n[0],e[1]=i[1]/n[1],e[2]=i[2]/n[2]):x(this,this,1/t),this}},{key:"inverse",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;return M(this,t),this}},{key:"len",value:function(){return g(this)}},{key:"distance",value:function(t){return t?(e=this,n=(i=t)[0]-e[0],r=i[1]-e[1],a=i[2]-e[2],Math.sqrt(n*n+r*r+a*a)):g(this);var e,i,n,r,a}},{key:"squaredLen",value:function(){return this.squaredDistance()}},{key:"squaredDistance",value:function(t){return t?(e=this,n=(i=t)[0]-e[0],r=i[1]-e[1],a=i[2]-e[2],n*n+r*r+a*a):function(t){var e=t[0],i=t[1],n=t[2];return e*e+i*i+n*n}(this);var e,i,n,r,a}},{key:"negate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;return b(this,t),this}},{key:"cross",value:function(t,e){var i,n,r,a,s,o,h,u,l;return i=this,r=e,a=(n=t)[0],s=n[1],o=n[2],h=r[0],u=r[1],l=r[2],i[0]=s*l-o*u,i[1]=o*h-a*l,i[2]=a*u-s*h,this}},{key:"scale",value:function(t){return x(this,this,t),this}},{key:"normalize",value:function(){return A(this,this),this}},{key:"dot",value:function(t){return E(this,t)}},{key:"equals",value:function(t){return i=t,(e=this)[0]===i[0]&&e[1]===i[1]&&e[2]===i[2];var e,i}},{key:"applyMatrix4",value:function(t){var e,i,n,r,a,s,o;return e=this,n=t,r=(i=this)[0],a=i[1],s=i[2],o=(o=n[3]*r+n[7]*a+n[11]*s+n[15])||1,e[0]=(n[0]*r+n[4]*a+n[8]*s+n[12])/o,e[1]=(n[1]*r+n[5]*a+n[9]*s+n[13])/o,e[2]=(n[2]*r+n[6]*a+n[10]*s+n[14])/o,this}},{key:"applyQuaternion",value:function(t){return function(t,e,i){var n=e[0],r=e[1],a=e[2],s=i[0],o=i[1],h=i[2],u=o*a-h*r,l=h*n-s*a,c=s*r-o*n,d=o*c-h*l,v=h*u-s*c,f=s*l-o*u,g=2*i[3];u*=g,l*=g,c*=g,d*=2,v*=2,f*=2,t[0]=n+u+d,t[1]=r+l+v,t[2]=a+c+f}(this,this,t),this}},{key:"angle",value:function(t){return T(this,t)}},{key:"lerp",value:function(t,e){return function(t,e,i,n){var r=e[0],a=e[1],s=e[2];t[0]=r+n*(i[0]-r),t[1]=a+n*(i[1]-a),t[2]=s+n*(i[2]-s)}(this,this,t,e),this}},{key:"clone",value:function(){return new i(this[0],this[1],this[2])}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this[0]=t[e],this[1]=t[e+1],this[2]=t[e+2],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t}},{key:"transformDirection",value:function(t){var e=this[0],i=this[1],n=this[2];return this[0]=t[0]*e+t[4]*i+t[8]*n,this[1]=t[1]*e+t[5]*i+t[9]*n,this[2]=t[2]*e+t[6]*i+t[10]*n,this.normalize()}}]),i}(v(Array)),R=new _,S=0,P=0,C=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(var n in o(this,t),this.gl=e,this.attributes=i,this.id=S++,this.VAOs={},this.drawRange={start:0,count:0},this.instancedCount=0,this.gl.renderer.bindVertexArray(null),this.gl.renderer.currentGeometry=null,this.glState=this.gl.renderer.state,i)this.addAttribute(n,i[n])}return h(t,[{key:"addAttribute",value:function(t,e){if(this.attributes[t]=e,e.id=P++,e.size=e.size||1,e.type=e.type||(e.data.constructor===Float32Array?this.gl.FLOAT:e.data.constructor===Uint16Array?this.gl.UNSIGNED_SHORT:this.gl.UNSIGNED_INT),e.target="index"===t?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER,e.normalize=e.normalize||!1,e.buffer=this.gl.createBuffer(),e.count=e.data.length/e.size,e.divisor=e.instanced||0,e.needsUpdate=!1,this.updateAttribute(e),e.divisor){if(this.isInstanced=!0,this.instancedCount&&this.instancedCount!==e.count*e.divisor)return console.warn("geometry has multiple instanced buffers of different length"),this.instancedCount=Math.min(this.instancedCount,e.count*e.divisor);this.instancedCount=e.count*e.divisor}else"index"===t?this.drawRange.count=e.count:this.attributes.index||(this.drawRange.count=Math.max(this.drawRange.count,e.count))}},{key:"updateAttribute",value:function(t){this.glState.boundBuffer!==t.id&&(this.gl.bindBuffer(t.target,t.buffer),this.glState.boundBuffer=t.id),this.gl.bufferData(t.target,t.data,this.gl.STATIC_DRAW),t.needsUpdate=!1}},{key:"setIndex",value:function(t){this.addAttribute("index",t)}},{key:"setDrawRange",value:function(t,e){this.drawRange.start=t,this.drawRange.count=e}},{key:"setInstancedCount",value:function(t){this.instancedCount=t}},{key:"createVAO",value:function(t){this.VAOs[t.attributeOrder]=this.gl.renderer.createVertexArray(),this.gl.renderer.bindVertexArray(this.VAOs[t.attributeOrder]),this.bindAttributes(t)}},{key:"bindAttributes",value:function(t){var e=this;t.attributeLocations.forEach((function(t,i){if(e.attributes[i]){var n=e.attributes[i];e.gl.bindBuffer(n.target,n.buffer),e.glState.boundBuffer=n.id,e.gl.vertexAttribPointer(t,n.size,n.type,n.normalize,0,0),e.gl.enableVertexAttribArray(t),e.gl.renderer.vertexAttribDivisor(t,n.divisor)}else console.warn("active attribute ".concat(i," not being supplied"))})),this.attributes.index&&this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.attributes.index.buffer)}},{key:"draw",value:function(t){var e=this,i=t.program,n=t.mode,r=void 0===n?this.gl.TRIANGLES:n;this.gl.renderer.currentGeometry!=="".concat(this.id,"_").concat(i.attributeOrder)&&(this.VAOs[i.attributeOrder]||this.createVAO(i),this.gl.renderer.bindVertexArray(this.VAOs[i.attributeOrder]),this.gl.renderer.currentGeometry="".concat(this.id,"_").concat(i.attributeOrder)),i.attributeLocations.forEach((function(t,i){var n=e.attributes[i];n.needsUpdate&&e.updateAttribute(n)})),this.isInstanced?this.attributes.index?this.gl.renderer.drawElementsInstanced(r,this.drawRange.count,this.attributes.index.type,this.drawRange.start,this.instancedCount):this.gl.renderer.drawArraysInstanced(r,this.drawRange.start,this.drawRange.count,this.instancedCount):this.attributes.index?this.gl.drawElements(r,this.drawRange.count,this.attributes.index.type,this.drawRange.start):this.gl.drawArrays(r,this.drawRange.start,this.drawRange.count)}},{key:"computeBoundingBox",value:function(t){!t&&this.attributes.position&&(t=this.attributes.position.data),t||console.warn("No position buffer found to compute bounds"),this.bounds||(this.bounds={min:new _,max:new _,center:new _,scale:new _,radius:1/0});var e=this.bounds.min,i=this.bounds.max,n=this.bounds.center,r=this.bounds.scale;e.set(1/0),i.set(-1/0);for(var a=0,s=t.length;a<s;a+=3){var o=t[a],h=t[a+1],u=t[a+2];e.x=Math.min(o,e.x),e.y=Math.min(h,e.y),e.z=Math.min(u,e.z),i.x=Math.max(o,i.x),i.y=Math.max(h,i.y),i.z=Math.max(u,i.z)}r.sub(i,e),n.add(e,i).divide(2)}},{key:"computeBoundingSphere",value:function(t){!t&&this.attributes.position&&(t=this.attributes.position.data),t||console.warn("No position buffer found to compute bounds"),this.bounds||this.computeBoundingBox(t);for(var e=0,i=0,n=t.length;i<n;i+=3)R.fromArray(t,i),e=Math.max(e,this.bounds.center.squaredDistance(R));this.bounds.radius=Math.sqrt(e)}},{key:"remove",value:function(){for(var t in this.vao&&this.gl.renderer.deleteVertexArray(this.vao),this.attributes)this.gl.deleteBuffer(this.attributes[t].buffer),delete this.attributes[t]}}]),t}(),B=0,L={},U=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=i.vertex,r=i.fragment,a=i.uniforms,s=void 0===a?{}:a,h=i.transparent,u=void 0!==h&&h,l=i.cullFace,c=void 0===l?e.BACK:l,d=i.frontFace,v=void 0===d?e.CCW:d,f=i.depthTest,g=void 0===f||f,p=i.depthWrite,m=void 0===p||p,y=i.depthFunc,w=void 0===y?e.LESS:y;o(this,t),this.gl=e,this.uniforms=s,this.id=B++,n||console.warn("vertex shader not supplied"),r||console.warn("fragment shader not supplied"),this.transparent=u,this.cullFace=c,this.frontFace=v,this.depthTest=g,this.depthWrite=m,this.depthFunc=w,this.blendFunc={},this.blendEquation={},this.transparent&&!this.blendFunc.src&&(this.gl.renderer.premultipliedAlpha?this.setBlendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA):this.setBlendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA));var x=e.createShader(e.VERTEX_SHADER);e.shaderSource(x,n),e.compileShader(x),""!==e.getShaderInfoLog(x)&&console.warn("".concat(e.getShaderInfoLog(x),"\nVertex Shader\n").concat(O(n)));var b=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(b,r),e.compileShader(b),""!==e.getShaderInfoLog(b)&&console.warn("".concat(e.getShaderInfoLog(b),"\nFragment Shader\n").concat(O(r))),this.program=e.createProgram(),e.attachShader(this.program,x),e.attachShader(this.program,b),e.linkProgram(this.program),!e.getProgramParameter(this.program,e.LINK_STATUS))return console.warn(e.getProgramInfoLog(this.program));e.deleteShader(x),e.deleteShader(b),this.uniformLocations=new Map;for(var M=e.getProgramParameter(this.program,e.ACTIVE_UNIFORMS),A=0;A<M;A++){var E=e.getActiveUniform(this.program,A);this.uniformLocations.set(E,e.getUniformLocation(this.program,E.name));var k=E.name.match(/(\w+)/g);E.uniformName=k[0],3===k.length?(E.isStructArray=!0,E.structIndex=Number(k[1]),E.structProperty=k[2]):2===k.length&&isNaN(Number(k[1]))&&(E.isStruct=!0,E.structProperty=k[1])}this.attributeLocations=new Map;for(var F=[],T=e.getProgramParameter(this.program,e.ACTIVE_ATTRIBUTES),_=0;_<T;_++){var R=e.getActiveAttrib(this.program,_),S=e.getAttribLocation(this.program,R.name);F[S]=R.name,this.attributeLocations.set(R.name,S)}this.attributeOrder=F.join("")}return h(t,[{key:"setBlendFunc",value:function(t,e,i,n){this.blendFunc.src=t,this.blendFunc.dst=e,this.blendFunc.srcAlpha=i,this.blendFunc.dstAlpha=n,t&&(this.transparent=!0)}},{key:"setBlendEquation",value:function(t,e){this.blendEquation.modeRGB=t,this.blendEquation.modeAlpha=e}},{key:"applyState",value:function(){this.depthTest?this.gl.renderer.enable(this.gl.DEPTH_TEST):this.gl.renderer.disable(this.gl.DEPTH_TEST),this.cullFace?this.gl.renderer.enable(this.gl.CULL_FACE):this.gl.renderer.disable(this.gl.CULL_FACE),this.blendFunc.src?this.gl.renderer.enable(this.gl.BLEND):this.gl.renderer.disable(this.gl.BLEND),this.cullFace&&this.gl.renderer.setCullFace(this.cullFace),this.gl.renderer.setFrontFace(this.frontFace),this.gl.renderer.setDepthMask(this.depthWrite),this.gl.renderer.setDepthFunc(this.depthFunc),this.blendFunc.src&&this.gl.renderer.setBlendFunc(this.blendFunc.src,this.blendFunc.dst,this.blendFunc.srcAlpha,this.blendFunc.dstAlpha),this.blendEquation.modeRGB&&this.gl.renderer.setBlendEquation(this.blendEquation.modeRGB,this.blendEquation.modeAlpha)}},{key:"use",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.flipFaces,n=void 0!==i&&i,r=-1,a=this.gl.renderer.currentProgram===this.id;a||(this.gl.useProgram(this.program),this.gl.renderer.currentProgram=this.id),this.uniformLocations.forEach((function(e,i){var n=i.uniformName,a=t.uniforms[n];if(i.isStruct&&(a=a[i.structProperty],n+=".".concat(i.structProperty)),i.isStructArray&&(a=a[i.structIndex][i.structProperty],n+="[".concat(i.structIndex,"].").concat(i.structProperty)),!a)return I("Active uniform ".concat(n," has not been supplied"));if(a&&void 0===a.value)return I("".concat(n," uniform is missing a value parameter"));if(a.value.texture)return r+=1,a.value.update(r),N(t.gl,i.type,e,r);if(a.value.length&&a.value[0].texture){var s=[];return a.value.forEach((function(t){r+=1,t.update(r),s.push(r)})),N(t.gl,i.type,e,s)}N(t.gl,i.type,e,a.value)})),this.applyState(),n&&this.gl.renderer.setFrontFace(this.frontFace===this.gl.CCW?this.gl.CW:this.gl.CCW)}},{key:"remove",value:function(){this.gl.deleteProgram(this.program)}}]),t}();function N(t,e,i,n){n=n.length?function(t){var e=t.length,i=t[0].length;if(void 0===i)return t;var n=e*i,r=L[n];r||(L[n]=r=new Float32Array(n));for(var a=0;a<e;a++)r.set(t[a],a*i);return r}(n):n;var r=t.renderer.state.uniformLocations.get(i);if(n.length)if(void 0===r)t.renderer.state.uniformLocations.set(i,n.slice(0));else{if(function(t,e){if(t.length!==e.length)return!1;for(var i=0,n=t.length;i<n;i++)if(t[i]!==e[i])return!1;return!0}(r,n))return;r.set?r.set(n):function(t,e){for(var i=0,n=t.length;i<n;i++)t[i]=e[i]}(r,n),t.renderer.state.uniformLocations.set(i,r)}else{if(r===n)return;t.renderer.state.uniformLocations.set(i,n)}switch(e){case 5126:return n.length?t.uniform1fv(i,n):t.uniform1f(i,n);case 35664:return t.uniform2fv(i,n);case 35665:return t.uniform3fv(i,n);case 35666:return t.uniform4fv(i,n);case 35670:case 5124:case 35678:case 35680:return n.length?t.uniform1iv(i,n):t.uniform1i(i,n);case 35671:case 35667:return t.uniform2iv(i,n);case 35672:case 35668:return t.uniform3iv(i,n);case 35673:case 35669:return t.uniform4iv(i,n);case 35674:return t.uniformMatrix2fv(i,!1,n);case 35675:return t.uniformMatrix3fv(i,!1,n);case 35676:return t.uniformMatrix4fv(i,!1,n)}}function O(t){for(var e=t.split("\n"),i=0;i<e.length;i++)e[i]=i+1+": "+e[i];return e.join("\n")}var D=0;function I(t){D>100||(console.warn(t),++D>100&&console.warn("More than 100 program warnings - stopping logs."))}var z=new _,G=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.canvas,n=void 0===i?document.createElement("canvas"):i,r=e.width,a=void 0===r?300:r,s=e.height,h=void 0===s?150:s,u=e.dpr,l=void 0===u?1:u,c=e.alpha,d=void 0!==c&&c,v=e.depth,f=void 0===v||v,g=e.stencil,p=void 0!==g&&g,m=e.antialias,y=void 0!==m&&m,w=e.premultipliedAlpha,x=void 0!==w&&w,b=e.preserveDrawingBuffer,M=void 0!==b&&b,A=e.powerPreference,E=void 0===A?"default":A,k=e.autoClear,F=void 0===k||k,T=e.webgl,_=void 0===T?2:T;o(this,t);var R={alpha:d,depth:f,stencil:p,antialias:y,premultipliedAlpha:x,preserveDrawingBuffer:M,powerPreference:E};this.dpr=l,this.alpha=d,this.color=!0,this.depth=f,this.stencil=p,this.premultipliedAlpha=x,this.autoClear=F,2===_&&(this.gl=n.getContext("webgl2",R)),this.isWebgl2=!!this.gl,this.gl||(this.gl=n.getContext("webgl",R)||n.getContext("experimental-webgl",R)),this.gl.renderer=this,this.setSize(a,h),this.parameters={},this.parameters.maxTextureUnits=this.gl.getParameter(this.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this.state={},this.state.blendFunc={src:this.gl.ONE,dst:this.gl.ZERO},this.state.blendEquation={modeRGB:this.gl.FUNC_ADD},this.state.cullFace=null,this.state.frontFace=this.gl.CCW,this.state.depthMask=!0,this.state.depthFunc=this.gl.LESS,this.state.premultiplyAlpha=!1,this.state.flipY=!1,this.state.unpackAlignment=4,this.state.framebuffer=null,this.state.viewport={width:null,height:null},this.state.textureUnits=[],this.state.activeTextureUnit=0,this.state.boundBuffer=null,this.state.uniformLocations=new Map,this.extensions={},this.isWebgl2?(this.getExtension("EXT_color_buffer_float"),this.getExtension("OES_texture_float_linear")):(this.getExtension("OES_texture_float"),this.getExtension("OES_texture_float_linear"),this.getExtension("OES_texture_half_float"),this.getExtension("OES_texture_half_float_linear"),this.getExtension("OES_element_index_uint"),this.getExtension("OES_standard_derivatives"),this.getExtension("EXT_sRGB"),this.getExtension("WEBGL_depth_texture"),this.getExtension("WEBGL_draw_buffers")),this.vertexAttribDivisor=this.getExtension("ANGLE_instanced_arrays","vertexAttribDivisor","vertexAttribDivisorANGLE"),this.drawArraysInstanced=this.getExtension("ANGLE_instanced_arrays","drawArraysInstanced","drawArraysInstancedANGLE"),this.drawElementsInstanced=this.getExtension("ANGLE_instanced_arrays","drawElementsInstanced","drawElementsInstancedANGLE"),this.createVertexArray=this.getExtension("OES_vertex_array_object","createVertexArray","createVertexArrayOES"),this.bindVertexArray=this.getExtension("OES_vertex_array_object","bindVertexArray","bindVertexArrayOES"),this.deleteVertexArray=this.getExtension("OES_vertex_array_object","deleteVertexArray","deleteVertexArrayOES"),this.drawBuffers=this.getExtension("WEBGL_draw_buffers","drawBuffers","drawBuffersWEBGL")}return h(t,[{key:"setSize",value:function(t,e){this.width=t,this.height=e,this.gl.canvas.width=t*this.dpr,this.gl.canvas.height=e*this.dpr,Object.assign(this.gl.canvas.style,{width:t+"px",height:e+"px"})}},{key:"setViewport",value:function(t,e){this.state.viewport.width===t&&this.state.viewport.height===e||(this.state.viewport.width=t,this.state.viewport.height=e,this.gl.viewport(0,0,t,e))}},{key:"enable",value:function(t){!0!==this.state[t]&&(this.gl.enable(t),this.state[t]=!0)}},{key:"disable",value:function(t){!1!==this.state[t]&&(this.gl.disable(t),this.state[t]=!1)}},{key:"setBlendFunc",value:function(t,e,i,n){this.state.blendFunc.src===t&&this.state.blendFunc.dst===e&&this.state.blendFunc.srcAlpha===i&&this.state.blendFunc.dstAlpha===n||(this.state.blendFunc.src=t,this.state.blendFunc.dst=e,this.state.blendFunc.srcAlpha=i,this.state.blendFunc.dstAlpha=n,void 0!==i?this.gl.blendFuncSeparate(t,e,i,n):this.gl.blendFunc(t,e))}},{key:"setBlendEquation",value:function(t,e){this.state.blendEquation.modeRGB===t&&this.state.blendEquation.modeAlpha===e||(this.state.blendEquation.modeRGB=t,this.state.blendEquation.modeAlpha=e,void 0!==e?this.gl.blendEquationSeparate(t,e):this.gl.blendEquation(t))}},{key:"setCullFace",value:function(t){this.state.cullFace!==t&&(this.state.cullFace=t,this.gl.cullFace(t))}},{key:"setFrontFace",value:function(t){this.state.frontFace!==t&&(this.state.frontFace=t,this.gl.frontFace(t))}},{key:"setDepthMask",value:function(t){this.state.depthMask!==t&&(this.state.depthMask=t,this.gl.depthMask(t))}},{key:"setDepthFunc",value:function(t){this.state.depthFunc!==t&&(this.state.depthFunc=t,this.gl.depthFunc(t))}},{key:"activeTexture",value:function(t){this.state.activeTextureUnit!==t&&(this.state.activeTextureUnit=t,this.gl.activeTexture(this.gl.TEXTURE0+t))}},{key:"bindFramebuffer",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.target,i=void 0===e?this.gl.FRAMEBUFFER:e,n=t.buffer,r=void 0===n?null:n;this.state.framebuffer!==r&&(this.state.framebuffer=r,this.gl.bindFramebuffer(i,r))}},{key:"getExtension",value:function(t,e,i){return e&&this.gl[e]?this.gl[e].bind(this.gl):(this.extensions[t]||(this.extensions[t]=this.gl.getExtension(t)),e?this.extensions[t]?this.extensions[t][i].bind(this.extensions[t]):null:this.extensions[t])}},{key:"sortOpaque",value:function(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program.id!==e.program.id?t.program.id-e.program.id:t.zDepth!==e.zDepth?t.zDepth-e.zDepth:e.id-t.id}},{key:"sortTransparent",value:function(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.zDepth!==e.zDepth?e.zDepth-t.zDepth:e.id-t.id}},{key:"sortUI",value:function(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program.id!==e.program.id?t.program.id-e.program.id:e.id-t.id}},{key:"getRenderList",value:function(t){var e=t.scene,i=t.camera,n=t.frustumCull,r=t.sort,a=[];if(i&&n&&i.updateFrustum(),e.traverse((function(t){if(!t.visible)return!0;t.draw&&(n&&t.frustumCulled&&i&&!i.frustumIntersectsMesh(t)||a.push(t))})),r){var s=[],o=[],h=[];a.forEach((function(t){t.program.transparent?t.program.depthTest?o.push(t):h.push(t):s.push(t),t.zDepth=0,0===t.renderOrder&&t.program.depthTest&&i&&(t.worldMatrix.getTranslation(z),z.applyMatrix4(i.projectionViewMatrix),t.zDepth=z.z)})),s.sort(this.sortOpaque),o.sort(this.sortTransparent),h.sort(this.sortUI),a=s.concat(o,h)}return a}},{key:"render",value:function(t){var e=t.scene,i=t.camera,n=t.target,r=void 0===n?null:n,a=t.update,s=void 0===a||a,o=t.sort,h=void 0===o||o,u=t.frustumCull,l=void 0===u||u,c=t.clear;null===r?(this.bindFramebuffer(),this.setViewport(this.width*this.dpr,this.height*this.dpr)):(this.bindFramebuffer(r),this.setViewport(r.width,r.height)),(c||this.autoClear&&!1!==c)&&(!this.depth||r&&!r.depth||(this.enable(this.gl.DEPTH_TEST),this.setDepthMask(!0)),this.gl.clear((this.color?this.gl.COLOR_BUFFER_BIT:0)|(this.depth?this.gl.DEPTH_BUFFER_BIT:0)|(this.stencil?this.gl.STENCIL_BUFFER_BIT:0))),s&&e.updateMatrixWorld(),i&&null===i.parent&&i.updateMatrixWorld(),this.getRenderList({scene:e,camera:i,frustumCull:l,sort:h}).forEach((function(t){t.draw({camera:i})}))}}]),t}();function q(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function V(t,e,i,n,r){return t[0]=e,t[1]=i,t[2]=n,t[3]=r,t}function Y(t,e){var i=e[0],n=e[1],r=e[2],a=e[3],s=i*i+n*n+r*r+a*a;return s>0&&(s=1/Math.sqrt(s)),t[0]=i*s,t[1]=n*s,t[2]=r*s,t[3]=a*s,t}function X(t,e,i){var n=e[0],r=e[1],a=e[2],s=e[3],o=i[0],h=i[1],u=i[2],l=i[3];return t[0]=n*l+s*o+r*u-a*h,t[1]=r*l+s*h+a*o-n*u,t[2]=a*l+s*u+n*h-r*o,t[3]=s*l-n*o-r*h-a*u,t}function W(t,e){var i=e[0],n=e[1],r=e[2],a=e[3],s=i*i+n*n+r*r+a*a,o=s?1/s:0;return t[0]=-i*o,t[1]=-n*o,t[2]=-r*o,t[3]=a*o,t}function j(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}var H=q,Z=V,Q=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},J=Y,K=function(t){l(i,t);var e=f(i);function i(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return o(this,i),(t=e.call(this,n,r,a,s)).onChange=function(){},c(t,u(t))}return h(i,[{key:"x",get:function(){return this[0]},set:function(t){this[0]=t,this.onChange()}},{key:"y",get:function(){return this[1]},set:function(t){this[1]=t,this.onChange()}},{key:"z",get:function(){return this[2]},set:function(t){this[2]=t,this.onChange()}},{key:"w",get:function(){return this[3]},set:function(t){this[3]=t,this.onChange()}},{key:"identity",value:function(){var t;return(t=this)[0]=0,t[1]=0,t[2]=0,t[3]=1,this.onChange(),this}},{key:"set",value:function(t,e,i,n){return t.length?this.copy(t):(Z(this,t,e,i,n),this.onChange(),this)}},{key:"rotateX",value:function(t){return function(t,e,i){i*=.5;var n=e[0],r=e[1],a=e[2],s=e[3],o=Math.sin(i),h=Math.cos(i);t[0]=n*h+s*o,t[1]=r*h+a*o,t[2]=a*h-r*o,t[3]=s*h-n*o}(this,this,t),this.onChange(),this}},{key:"rotateY",value:function(t){return function(t,e,i){i*=.5;var n=e[0],r=e[1],a=e[2],s=e[3],o=Math.sin(i),h=Math.cos(i);t[0]=n*h-a*o,t[1]=r*h+s*o,t[2]=a*h+n*o,t[3]=s*h-r*o}(this,this,t),this.onChange(),this}},{key:"rotateZ",value:function(t){return function(t,e,i){i*=.5;var n=e[0],r=e[1],a=e[2],s=e[3],o=Math.sin(i),h=Math.cos(i);t[0]=n*h+r*o,t[1]=r*h-n*o,t[2]=a*h+s*o,t[3]=s*h-a*o}(this,this,t),this.onChange(),this}},{key:"inverse",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;return W(this,t),this.onChange(),this}},{key:"conjugate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;return j(this,t),this.onChange(),this}},{key:"copy",value:function(t){return H(this,t),this.onChange(),this}},{key:"normalize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;return J(this,t),this.onChange(),this}},{key:"multiply",value:function(t,e){return e?X(this,t,e):X(this,this,t),this.onChange(),this}},{key:"dot",value:function(t){return Q(this,t)}},{key:"fromMatrix3",value:function(t){return function(t,e){var i,n=e[0]+e[4]+e[8];if(n>0)i=Math.sqrt(n+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{var r=0;e[4]>e[0]&&(r=1),e[8]>e[3*r+r]&&(r=2);var a=(r+1)%3,s=(r+2)%3;i=Math.sqrt(e[3*r+r]-e[3*a+a]-e[3*s+s]+1),t[r]=.5*i,i=.5/i,t[3]=(e[3*a+s]-e[3*s+a])*i,t[a]=(e[3*a+r]+e[3*r+a])*i,t[s]=(e[3*s+r]+e[3*r+s])*i}}(this,t),this.onChange(),this}},{key:"fromEuler",value:function(t){return function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"YXZ",n=Math.sin(.5*e[0]),r=Math.cos(.5*e[0]),a=Math.sin(.5*e[1]),s=Math.cos(.5*e[1]),o=Math.sin(.5*e[2]),h=Math.cos(.5*e[2]);"XYZ"===i?(t[0]=n*s*h+r*a*o,t[1]=r*a*h-n*s*o,t[2]=r*s*o+n*a*h,t[3]=r*s*h-n*a*o):"YXZ"===i?(t[0]=n*s*h+r*a*o,t[1]=r*a*h-n*s*o,t[2]=r*s*o-n*a*h,t[3]=r*s*h+n*a*o):"ZXY"===i?(t[0]=n*s*h-r*a*o,t[1]=r*a*h+n*s*o,t[2]=r*s*o+n*a*h,t[3]=r*s*h-n*a*o):"ZYX"===i?(t[0]=n*s*h-r*a*o,t[1]=r*a*h+n*s*o,t[2]=r*s*o-n*a*h,t[3]=r*s*h+n*a*o):"YZX"===i?(t[0]=n*s*h+r*a*o,t[1]=r*a*h+n*s*o,t[2]=r*s*o-n*a*h,t[3]=r*s*h-n*a*o):"XZY"===i&&(t[0]=n*s*h-r*a*o,t[1]=r*a*h-n*s*o,t[2]=r*s*o+n*a*h,t[3]=r*s*h+n*a*o)}(this,t,t.order),this}},{key:"fromAxisAngle",value:function(t,e){return function(t,e,i){i*=.5;var n=Math.sin(i);t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(i)}(this,t,e),this}},{key:"slerp",value:function(t,e){return function(t,e,i,n){var r,a,s,o,h,u=e[0],l=e[1],c=e[2],d=e[3],v=i[0],f=i[1],g=i[2],p=i[3];(a=u*v+l*f+c*g+d*p)<0&&(a=-a,v=-v,f=-f,g=-g,p=-p),1-a>1e-6?(r=Math.acos(a),s=Math.sin(r),o=Math.sin((1-n)*r)/s,h=Math.sin(n*r)/s):(o=1-n,h=n),t[0]=o*u+h*v,t[1]=o*l+h*f,t[2]=o*c+h*g,t[3]=o*d+h*p}(this,this,t,e),this}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this[0]=t[e],this[1]=t[e+1],this[2]=t[e+2],this[3]=t[e+3],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t[e+3]=this[3],t}}]),i}(v(Array));function $(t,e){var i=e[0],n=e[1],r=e[2],a=e[3],s=e[4],o=e[5],h=e[6],u=e[7],l=e[8],c=e[9],d=e[10],v=e[11],f=e[12],g=e[13],p=e[14],m=e[15],y=i*o-n*s,w=i*h-r*s,x=i*u-a*s,b=n*h-r*o,M=n*u-a*o,A=r*u-a*h,E=l*g-c*f,k=l*p-d*f,F=l*m-v*f,T=c*p-d*g,_=c*m-v*g,R=d*m-v*p,S=y*R-w*_+x*T+b*F-M*k+A*E;return S?(S=1/S,t[0]=(o*R-h*_+u*T)*S,t[1]=(r*_-n*R-a*T)*S,t[2]=(g*A-p*M+m*b)*S,t[3]=(d*M-c*A-v*b)*S,t[4]=(h*F-s*R-u*k)*S,t[5]=(i*R-r*F+a*k)*S,t[6]=(p*x-f*A-m*w)*S,t[7]=(l*A-d*x+v*w)*S,t[8]=(s*_-o*F+u*E)*S,t[9]=(n*F-i*_-a*E)*S,t[10]=(f*M-g*x+m*y)*S,t[11]=(c*x-l*M-v*y)*S,t[12]=(o*k-s*T-h*E)*S,t[13]=(i*T-n*k+r*E)*S,t[14]=(g*w-f*b-p*y)*S,t[15]=(l*b-c*w+d*y)*S,t):null}function tt(t,e,i){var n=e[0],r=e[1],a=e[2],s=e[3],o=e[4],h=e[5],u=e[6],l=e[7],c=e[8],d=e[9],v=e[10],f=e[11],g=e[12],p=e[13],m=e[14],y=e[15],w=i[0],x=i[1],b=i[2],M=i[3];return t[0]=w*n+x*o+b*c+M*g,t[1]=w*r+x*h+b*d+M*p,t[2]=w*a+x*u+b*v+M*m,t[3]=w*s+x*l+b*f+M*y,w=i[4],x=i[5],b=i[6],M=i[7],t[4]=w*n+x*o+b*c+M*g,t[5]=w*r+x*h+b*d+M*p,t[6]=w*a+x*u+b*v+M*m,t[7]=w*s+x*l+b*f+M*y,w=i[8],x=i[9],b=i[10],M=i[11],t[8]=w*n+x*o+b*c+M*g,t[9]=w*r+x*h+b*d+M*p,t[10]=w*a+x*u+b*v+M*m,t[11]=w*s+x*l+b*f+M*y,w=i[12],x=i[13],b=i[14],M=i[15],t[12]=w*n+x*o+b*c+M*g,t[13]=w*r+x*h+b*d+M*p,t[14]=w*a+x*u+b*v+M*m,t[15]=w*s+x*l+b*f+M*y,t}function et(t,e,i){var n,r,a,s,o,h,u,l,c,d,v,f,g=i[0],p=i[1],m=i[2];return e===t?(t[12]=e[0]*g+e[4]*p+e[8]*m+e[12],t[13]=e[1]*g+e[5]*p+e[9]*m+e[13],t[14]=e[2]*g+e[6]*p+e[10]*m+e[14],t[15]=e[3]*g+e[7]*p+e[11]*m+e[15]):(n=e[0],r=e[1],a=e[2],s=e[3],o=e[4],h=e[5],u=e[6],l=e[7],c=e[8],d=e[9],v=e[10],f=e[11],t[0]=n,t[1]=r,t[2]=a,t[3]=s,t[4]=o,t[5]=h,t[6]=u,t[7]=l,t[8]=c,t[9]=d,t[10]=v,t[11]=f,t[12]=n*g+o*p+c*m+e[12],t[13]=r*g+h*p+d*m+e[13],t[14]=a*g+u*p+v*m+e[14],t[15]=s*g+l*p+f*m+e[15]),t}function it(t,e,i){var n=i[0],r=i[1],a=i[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function nt(t,e,i){var n=Math.sin(i),r=Math.cos(i),a=e[4],s=e[5],o=e[6],h=e[7],u=e[8],l=e[9],c=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*r+u*n,t[5]=s*r+l*n,t[6]=o*r+c*n,t[7]=h*r+d*n,t[8]=u*r-a*n,t[9]=l*r-s*n,t[10]=c*r-o*n,t[11]=d*r-h*n,t}function rt(t,e,i){var n=Math.sin(i),r=Math.cos(i),a=e[0],s=e[1],o=e[2],h=e[3],u=e[8],l=e[9],c=e[10],d=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*r-u*n,t[1]=s*r-l*n,t[2]=o*r-c*n,t[3]=h*r-d*n,t[8]=a*n+u*r,t[9]=s*n+l*r,t[10]=o*n+c*r,t[11]=h*n+d*r,t}function at(t,e,i){var n=Math.sin(i),r=Math.cos(i),a=e[0],s=e[1],o=e[2],h=e[3],u=e[4],l=e[5],c=e[6],d=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*r+u*n,t[1]=s*r+l*n,t[2]=o*r+c*n,t[3]=h*r+d*n,t[4]=u*r-a*n,t[5]=l*r-s*n,t[6]=c*r-o*n,t[7]=d*r-h*n,t}function st(t,e,i,n,r){var a=1/Math.tan(e/2),s=1/(n-r);return t[0]=a/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(r+n)*s,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*r*n*s,t[15]=0,t}var ot=function(t){l(i,t);var e=f(i);function i(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,d=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,v=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,f=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,g=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,p=arguments.length>10&&void 0!==arguments[10]?arguments[10]:1,m=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,y=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,w=arguments.length>13&&void 0!==arguments[13]?arguments[13]:0,x=arguments.length>14&&void 0!==arguments[14]?arguments[14]:0,b=arguments.length>15&&void 0!==arguments[15]?arguments[15]:1;return o(this,i),t=e.call(this,n,r,a,s,h,l,d,v,f,g,p,m,y,w,x,b),c(t,u(t))}return h(i,[{key:"x",get:function(){return this[12]},set:function(t){this[12]=t}},{key:"y",get:function(){return this[13]},set:function(t){this[13]=t}},{key:"z",get:function(){return this[14]},set:function(t){this[14]=t}},{key:"w",get:function(){return this[15]},set:function(t){this[15]=t}},{key:"set",value:function(t,e,i,n,r,a,s,o,h,u,l,c,d,v,f,g){return t.length?this.copy(t):(function(t,e,i,n,r,a,s,o,h,u,l,c,d,v,f,g,p){t[0]=e,t[1]=i,t[2]=n,t[3]=r,t[4]=a,t[5]=s,t[6]=o,t[7]=h,t[8]=u,t[9]=l,t[10]=c,t[11]=d,t[12]=v,t[13]=f,t[14]=g,t[15]=p}(this,t,e,i,n,r,a,s,o,h,u,l,c,d,v,f,g),this)}},{key:"translate",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;return et(this,e,t),this}},{key:"rotateX",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;return nt(this,e,t),this}},{key:"rotateY",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;return rt(this,e,t),this}},{key:"rotateZ",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;return at(this,e,t),this}},{key:"scale",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;return it(this,e,"number"==typeof t?[t,t,t]:t),this}},{key:"multiply",value:function(t,e){return e?tt(this,t,e):tt(this,this,t),this}},{key:"identity",value:function(){var t;return(t=this)[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"copy",value:function(t){var e,i;return i=t,(e=this)[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}},{key:"fromPerspective",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.fov,i=t.aspect,n=t.near,r=t.far;return st(this,e,i,n,r),this}},{key:"fromOrthogonal",value:function(t){return function(t,e,i,n,r,a,s){var o=1/(e-i),h=1/(n-r),u=1/(a-s);t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+i)*o,t[13]=(r+n)*h,t[14]=(s+a)*u,t[15]=1}(this,t.left,t.right,t.bottom,t.top,t.near,t.far),this}},{key:"fromQuaternion",value:function(t){return function(t,e){var i=e[0],n=e[1],r=e[2],a=e[3],s=i+i,o=n+n,h=r+r,u=i*s,l=n*s,c=n*o,d=r*s,v=r*o,f=r*h,g=a*s,p=a*o,m=a*h;t[0]=1-c-f,t[1]=l+m,t[2]=d-p,t[3]=0,t[4]=l-m,t[5]=1-u-f,t[6]=v+g,t[7]=0,t[8]=d+p,t[9]=v-g,t[10]=1-u-c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(this,t),this}},{key:"setPosition",value:function(t){return this.x=t[0],this.y=t[1],this.z=t[2],this}},{key:"inverse",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;return $(this,t),this}},{key:"compose",value:function(t,e,i){return function(t,e,i,n){var r=e[0],a=e[1],s=e[2],o=e[3],h=r+r,u=a+a,l=s+s,c=r*h,d=r*u,v=r*l,f=a*u,g=a*l,p=s*l,m=o*h,y=o*u,w=o*l,x=n[0],b=n[1],M=n[2];t[0]=(1-(f+p))*x,t[1]=(d+w)*x,t[2]=(v-y)*x,t[3]=0,t[4]=(d-w)*b,t[5]=(1-(c+p))*b,t[6]=(g+m)*b,t[7]=0,t[8]=(v+y)*M,t[9]=(g-m)*M,t[10]=(1-(c+f))*M,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1}(this,t,e,i),this}},{key:"getRotation",value:function(t){var e,i,n,r;return e=t,n=(i=this)[0]+i[5]+i[10],r=0,n>0?(r=2*Math.sqrt(n+1),e[3]=.25*r,e[0]=(i[6]-i[9])/r,e[1]=(i[8]-i[2])/r,e[2]=(i[1]-i[4])/r):i[0]>i[5]&&i[0]>i[10]?(r=2*Math.sqrt(1+i[0]-i[5]-i[10]),e[3]=(i[6]-i[9])/r,e[0]=.25*r,e[1]=(i[1]+i[4])/r,e[2]=(i[8]+i[2])/r):i[5]>i[10]?(r=2*Math.sqrt(1+i[5]-i[0]-i[10]),e[3]=(i[8]-i[2])/r,e[0]=(i[1]+i[4])/r,e[1]=.25*r,e[2]=(i[6]+i[9])/r):(r=2*Math.sqrt(1+i[10]-i[0]-i[5]),e[3]=(i[1]-i[4])/r,e[0]=(i[8]+i[2])/r,e[1]=(i[6]+i[9])/r,e[2]=.25*r),this}},{key:"getTranslation",value:function(t){var e,i;return i=this,(e=t)[0]=i[12],e[1]=i[13],e[2]=i[14],this}},{key:"getScaling",value:function(t){var e,i,n,r,a,s,o,h,u,l,c;return e=t,n=(i=this)[0],r=i[1],a=i[2],s=i[4],o=i[5],h=i[6],u=i[8],l=i[9],c=i[10],e[0]=Math.sqrt(n*n+r*r+a*a),e[1]=Math.sqrt(s*s+o*o+h*h),e[2]=Math.sqrt(u*u+l*l+c*c),this}},{key:"getMaxScaleOnAxis",value:function(){return e=(t=this)[0],i=t[1],n=t[2],r=t[4],a=t[5],s=t[6],o=t[8],h=t[9],u=t[10],l=e*e+i*i+n*n,c=r*r+a*a+s*s,d=o*o+h*h+u*u,Math.sqrt(Math.max(l,c,d));var t,e,i,n,r,a,s,o,h,u,l,c,d}},{key:"lookAt",value:function(t,e,i){return function(t,e,i,n){var r=e[0],a=e[1],s=e[2],o=n[0],h=n[1],u=n[2],l=r-i[0],c=a-i[1],d=s-i[2],v=l*l+c*c+d*d;v>0&&(l*=v=1/Math.sqrt(v),c*=v,d*=v);var f=h*d-u*c,g=u*l-o*d,p=o*c-h*l;(v=f*f+g*g+p*p)>0&&(f*=v=1/Math.sqrt(v),g*=v,p*=v),t[0]=f,t[1]=g,t[2]=p,t[3]=0,t[4]=c*p-d*g,t[5]=d*f-l*p,t[6]=l*g-c*f,t[7]=0,t[8]=l,t[9]=c,t[10]=d,t[11]=0,t[12]=r,t[13]=a,t[14]=s,t[15]=1}(this,t,e,i),this}},{key:"determinant",value:function(){return e=(t=this)[0],i=t[1],n=t[2],r=t[3],a=t[4],s=t[5],o=t[6],h=t[7],u=t[8],l=t[9],c=t[10],d=t[11],v=t[12],f=t[13],g=t[14],p=t[15],(e*s-i*a)*(c*p-d*g)-(e*o-n*a)*(l*p-d*f)+(e*h-r*a)*(l*g-c*f)+(i*o-n*s)*(u*p-d*v)-(i*h-r*s)*(u*g-c*v)+(n*h-r*o)*(u*f-l*v);var t,e,i,n,r,a,s,o,h,u,l,c,d,v,f,g,p}}]),i}(v(Array));function ht(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"YXZ";return"XYZ"===i?(t[1]=Math.asin(Math.min(Math.max(e[8],-1),1)),Math.abs(e[8])<.99999?(t[0]=Math.atan2(-e[9],e[10]),t[2]=Math.atan2(-e[4],e[0])):(t[0]=Math.atan2(e[6],e[5]),t[2]=0)):"YXZ"===i?(t[0]=Math.asin(-Math.min(Math.max(e[9],-1),1)),Math.abs(e[9])<.99999?(t[1]=Math.atan2(e[8],e[10]),t[2]=Math.atan2(e[1],e[5])):(t[1]=Math.atan2(-e[2],e[0]),t[2]=0)):"ZXY"===i?(t[0]=Math.asin(Math.min(Math.max(e[6],-1),1)),Math.abs(e[6])<.99999?(t[1]=Math.atan2(-e[2],e[10]),t[2]=Math.atan2(-e[4],e[5])):(t[1]=0,t[2]=Math.atan2(e[1],e[0]))):"ZYX"===i?(t[1]=Math.asin(-Math.min(Math.max(e[2],-1),1)),Math.abs(e[2])<.99999?(t[0]=Math.atan2(e[6],e[10]),t[2]=Math.atan2(e[1],e[0])):(t[0]=0,t[2]=Math.atan2(-e[4],e[5]))):"YZX"===i?(t[2]=Math.asin(Math.min(Math.max(e[1],-1),1)),Math.abs(e[1])<.99999?(t[0]=Math.atan2(-e[9],e[5]),t[1]=Math.atan2(-e[2],e[0])):(t[0]=0,t[1]=Math.atan2(e[8],e[10]))):"XZY"===i&&(t[2]=Math.asin(-Math.min(Math.max(e[4],-1),1)),Math.abs(e[4])<.99999?(t[0]=Math.atan2(e[6],e[5]),t[1]=Math.atan2(e[8],e[0])):(t[0]=Math.atan2(-e[9],e[10]),t[1]=0)),t}var ut=new ot,lt=function(t){l(i,t);var e=f(i);function i(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"YXZ";return o(this,i),(t=e.call(this,n,r,a)).order=s,t.onChange=function(){},c(t,u(t))}return h(i,[{key:"x",get:function(){return this[0]},set:function(t){this[0]=t,this.onChange()}},{key:"y",get:function(){return this[1]},set:function(t){this[1]=t,this.onChange()}},{key:"z",get:function(){return this[2]},set:function(t){this[2]=t,this.onChange()}},{key:"set",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t;return t.length?this.copy(t):(this[0]=t,this[1]=e,this[2]=i,this.onChange(),this)}},{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.onChange(),this}},{key:"reorder",value:function(t){return this.order=t,this.onChange(),this}},{key:"fromRotationMatrix",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.order;return ht(this,t,e),this}},{key:"fromQuaternion",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.order;return ut.fromQuaternion(t),this.fromRotationMatrix(ut,e)}}]),i}(v(Array)),ct=function(){function t(){var e=this;o(this,t),this.parent=null,this.children=[],this.visible=!0,this.matrix=new ot,this.worldMatrix=new ot,this.matrixAutoUpdate=!0,this.position=new _,this.quaternion=new K,this.scale=new _(1),this.rotation=new lt,this.up=new _(0,1,0),this.rotation.onChange=function(){return e.quaternion.fromEuler(e.rotation)},this.quaternion.onChange=function(){return e.rotation.fromQuaternion(e.quaternion)}}return h(t,[{key:"setParent",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e&&this.parent&&t!==this.parent&&this.parent.removeChild(this,!1),this.parent=t,e&&t&&t.addChild(this,!1)}},{key:"addChild",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];~this.children.indexOf(t)||this.children.push(t),e&&t.setParent(this,!1)}},{key:"removeChild",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];~this.children.indexOf(t)&&this.children.splice(this.children.indexOf(t),1),e&&t.setParent(null,!1)}},{key:"updateMatrixWorld",value:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.worldMatrixNeedsUpdate||t)&&(null===this.parent?this.worldMatrix.copy(this.matrix):this.worldMatrix.multiply(this.parent.worldMatrix,this.matrix),this.worldMatrixNeedsUpdate=!1,t=!0);for(var e=0,i=this.children.length;e<i;e++)this.children[e].updateMatrixWorld(t)}},{key:"updateMatrix",value:function(){this.matrix.compose(this.quaternion,this.position,this.scale),this.worldMatrixNeedsUpdate=!0}},{key:"traverse",value:function(t){if(!t(this))for(var e=0,i=this.children.length;e<i;e++)this.children[e].traverse(t)}},{key:"decompose",value:function(){this.matrix.getTranslation(this.position),this.matrix.getRotation(this.quaternion),this.matrix.getScaling(this.scale),this.rotation.fromQuaternion(this.quaternion)}},{key:"lookAt",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e?this.matrix.lookAt(this.position,t,this.up):this.matrix.lookAt(t,this.position,this.up),this.matrix.getRotation(this.quaternion),this.rotation.fromQuaternion(this.quaternion)}}]),t}(),dt=new ot,vt=new _,ft=new _,gt=function(t){l(i,t);var e=f(i);function i(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=r.near,s=void 0===a?.1:a,h=r.far,u=void 0===h?100:h,l=r.fov,c=void 0===l?45:l,d=r.aspect,v=void 0===d?1:d,f=r.left,g=r.right,p=r.bottom,m=r.top;return o(this,i),(n=e.call(this,t)).near=s,n.far=u,n.fov=c,n.aspect=v,n.projectionMatrix=new ot,n.viewMatrix=new ot,n.projectionViewMatrix=new ot,f||g?n.orthographic({left:f,right:g,bottom:p,top:m}):n.perspective(),n}return h(i,[{key:"perspective",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.near,i=void 0===e?this.near:e,n=t.far,r=void 0===n?this.far:n,a=t.fov,s=void 0===a?this.fov:a,o=t.aspect,h=void 0===o?this.aspect:o;return this.projectionMatrix.fromPerspective({fov:s*(Math.PI/180),aspect:h,near:i,far:r}),this.type="perspective",this}},{key:"orthographic",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.near,i=void 0===e?this.near:e,n=t.far,r=void 0===n?this.far:n,a=t.left,s=void 0===a?-1:a,o=t.right,h=void 0===o?1:o,u=t.bottom,l=void 0===u?-1:u,c=t.top,d=void 0===c?1:c;return this.projectionMatrix.fromOrthogonal({left:s,right:h,bottom:l,top:d,near:i,far:r}),this.type="orthographic",this}},{key:"updateMatrixWorld",value:function(){return s(d(i.prototype),"updateMatrixWorld",this).call(this),this.viewMatrix.inverse(this.worldMatrix),this.projectionViewMatrix.multiply(this.projectionMatrix,this.viewMatrix),this}},{key:"lookAt",value:function(t){return s(d(i.prototype),"lookAt",this).call(this,t,!0),this}},{key:"project",value:function(t){return t.applyMatrix4(this.viewMatrix),t.applyMatrix4(this.projectionMatrix),this}},{key:"unproject",value:function(t){return t.applyMatrix4(dt.inverse(this.projectionMatrix)),t.applyMatrix4(this.worldMatrix),this}},{key:"updateFrustum",value:function(){this.frustum||(this.frustum=[new _,new _,new _,new _,new _,new _]);var t=this.projectionViewMatrix;this.frustum[0].set(t[3]-t[0],t[7]-t[4],t[11]-t[8]).constant=t[15]-t[12],this.frustum[1].set(t[3]+t[0],t[7]+t[4],t[11]+t[8]).constant=t[15]+t[12],this.frustum[2].set(t[3]+t[1],t[7]+t[5],t[11]+t[9]).constant=t[15]+t[13],this.frustum[3].set(t[3]-t[1],t[7]-t[5],t[11]-t[9]).constant=t[15]-t[13],this.frustum[4].set(t[3]-t[2],t[7]-t[6],t[11]-t[10]).constant=t[15]-t[14],this.frustum[5].set(t[3]+t[2],t[7]+t[6],t[11]+t[10]).constant=t[15]+t[14];for(var e=0;e<6;e++){var i=1/this.frustum[e].distance();this.frustum[e].multiply(i),this.frustum[e].constant*=i}}},{key:"frustumIntersectsMesh",value:function(t){if(!t.geometry.attributes.position)return!0;t.geometry.bounds&&t.geometry.bounds.radius!==1/0||t.geometry.computeBoundingSphere();var e=vt;e.copy(t.geometry.bounds.center),e.applyMatrix4(t.worldMatrix);var i=t.geometry.bounds.radius*t.worldMatrix.getMaxScaleOnAxis();return this.frustumIntersectsSphere(e,i)}},{key:"frustumIntersectsSphere",value:function(t,e){for(var i=ft,n=0;n<6;n++){var r=this.frustum[n];if(i.copy(r).dot(t)+r.constant<-e)return!1}return!0}}]),i}(ct);function pt(t,e){var i=e[0],n=e[1],r=e[2],a=e[3],s=e[4],o=e[5],h=e[6],u=e[7],l=e[8],c=l*s-o*u,d=-l*a+o*h,v=u*a-s*h,f=i*c+n*d+r*v;return f?(f=1/f,t[0]=c*f,t[1]=(-l*n+r*u)*f,t[2]=(o*n-r*s)*f,t[3]=d*f,t[4]=(l*i-r*h)*f,t[5]=(-o*i+r*a)*f,t[6]=v*f,t[7]=(-u*i+n*h)*f,t[8]=(s*i-n*a)*f,t):null}function mt(t,e,i){var n=e[0],r=e[1],a=e[2],s=e[3],o=e[4],h=e[5],u=e[6],l=e[7],c=e[8],d=i[0],v=i[1],f=i[2],g=i[3],p=i[4],m=i[5],y=i[6],w=i[7],x=i[8];return t[0]=d*n+v*s+f*u,t[1]=d*r+v*o+f*l,t[2]=d*a+v*h+f*c,t[3]=g*n+p*s+m*u,t[4]=g*r+p*o+m*l,t[5]=g*a+p*h+m*c,t[6]=y*n+w*s+x*u,t[7]=y*r+w*o+x*l,t[8]=y*a+w*h+x*c,t}function yt(t,e,i){var n=e[0],r=e[1],a=e[2],s=e[3],o=e[4],h=e[5],u=e[6],l=e[7],c=e[8],d=i[0],v=i[1];return t[0]=n,t[1]=r,t[2]=a,t[3]=s,t[4]=o,t[5]=h,t[6]=d*n+v*s+u,t[7]=d*r+v*o+l,t[8]=d*a+v*h+c,t}function wt(t,e,i){var n=e[0],r=e[1],a=e[2],s=e[3],o=e[4],h=e[5],u=e[6],l=e[7],c=e[8],d=Math.sin(i),v=Math.cos(i);return t[0]=v*n+d*s,t[1]=v*r+d*o,t[2]=v*a+d*h,t[3]=v*s-d*n,t[4]=v*o-d*r,t[5]=v*h-d*a,t[6]=u,t[7]=l,t[8]=c,t}function xt(t,e,i){var n=i[0],r=i[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=r*e[3],t[4]=r*e[4],t[5]=r*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}var bt=function(t){l(i,t);var e=f(i);function i(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,d=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,v=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,f=arguments.length>8&&void 0!==arguments[8]?arguments[8]:1;return o(this,i),t=e.call(this,n,r,a,s,h,l,d,v,f),c(t,u(t))}return h(i,[{key:"set",value:function(t,e,i,n,r,a,s,o,h){return t.length?this.copy(t):(function(t,e,i,n,r,a,s,o,h,u){t[0]=e,t[1]=i,t[2]=n,t[3]=r,t[4]=a,t[5]=s,t[6]=o,t[7]=h,t[8]=u}(this,t,e,i,n,r,a,s,o,h),this)}},{key:"translate",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;return yt(this,e,t),this}},{key:"rotate",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;return wt(this,e,t),this}},{key:"scale",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;return xt(this,e,t),this}},{key:"multiply",value:function(t,e){return e?mt(this,t,e):mt(this,this,t),this}},{key:"identity",value:function(){var t;return(t=this)[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,this}},{key:"copy",value:function(t){var e,i;return i=t,(e=this)[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}},{key:"fromMatrix4",value:function(t){var e,i;return i=t,(e=this)[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[4],e[4]=i[5],e[5]=i[6],e[6]=i[8],e[7]=i[9],e[8]=i[10],this}},{key:"fromQuaternion",value:function(t){return function(t,e){var i=e[0],n=e[1],r=e[2],a=e[3],s=i+i,o=n+n,h=r+r,u=i*s,l=n*s,c=n*o,d=r*s,v=r*o,f=r*h,g=a*s,p=a*o,m=a*h;t[0]=1-c-f,t[3]=l-m,t[6]=d+p,t[1]=l+m,t[4]=1-u-f,t[7]=v-g,t[2]=d-p,t[5]=v+g,t[8]=1-u-c}(this,t),this}},{key:"fromBasis",value:function(t,e,i){return this.set(t[0],t[1],t[2],e[0],e[1],e[2],i[0],i[1],i[2]),this}},{key:"inverse",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;return pt(this,t),this}},{key:"getNormalMatrix",value:function(t){var e,i,n,r,a,s,o,h,u,l,c,d,v,f,g,p,m,y,w,x,b,M,A,E,k,F,T,_,R,S,P;return e=this,n=(i=t)[0],r=i[1],a=i[2],s=i[3],o=i[4],h=i[5],u=i[6],l=i[7],c=i[8],d=i[9],v=i[10],f=i[11],g=i[12],p=i[13],m=i[14],y=i[15],(P=(w=n*h-r*o)*(S=v*y-f*m)-(x=n*u-a*o)*(R=d*y-f*p)+(b=n*l-s*o)*(_=d*m-v*p)+(M=r*u-a*h)*(T=c*y-f*g)-(A=r*l-s*h)*(F=c*m-v*g)+(E=a*l-s*u)*(k=c*p-d*g))&&(P=1/P,e[0]=(h*S-u*R+l*_)*P,e[1]=(u*T-o*S-l*F)*P,e[2]=(o*R-h*T+l*k)*P,e[3]=(a*R-r*S-s*_)*P,e[4]=(n*S-a*T+s*F)*P,e[5]=(r*T-n*R-s*k)*P,e[6]=(p*E-m*A+y*M)*P,e[7]=(m*b-g*E-y*x)*P,e[8]=(g*A-p*b+y*w)*P),this}}]),i}(v(Array)),Mt=0,At=function(t){l(i,t);var e=f(i);function i(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=r.geometry,s=r.program,h=r.mode,u=void 0===h?t.TRIANGLES:h,l=r.frustumCulled,c=void 0===l||l,d=r.renderOrder,v=void 0===d?0:d;return o(this,i),(n=e.call(this,t)).gl=t,n.id=Mt++,n.geometry=a,n.program=s,n.mode=u,n.frustumCulled=c,n.renderOrder=v,n.modelViewMatrix=new ot,n.normalMatrix=new bt,n.beforeRenderCallbacks=[],n.afterRenderCallbacks=[],n}return h(i,[{key:"onBeforeRender",value:function(t){return this.beforeRenderCallbacks.push(t),this}},{key:"onAfterRender",value:function(t){return this.afterRenderCallbacks.push(t),this}},{key:"draw",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.camera;this.beforeRenderCallbacks.forEach((function(e){return e&&e({mesh:t,camera:i})})),i&&(this.program.uniforms.modelMatrix||Object.assign(this.program.uniforms,{modelMatrix:{value:null},viewMatrix:{value:null},modelViewMatrix:{value:null},normalMatrix:{value:null},projectionMatrix:{value:null},cameraPosition:{value:null}}),this.program.uniforms.projectionMatrix.value=i.projectionMatrix,this.program.uniforms.cameraPosition.value=i.position,this.program.uniforms.viewMatrix.value=i.viewMatrix,this.modelViewMatrix.multiply(i.viewMatrix,this.worldMatrix),this.normalMatrix.getNormalMatrix(this.modelViewMatrix),this.program.uniforms.modelMatrix.value=this.worldMatrix,this.program.uniforms.modelViewMatrix.value=this.modelViewMatrix,this.program.uniforms.normalMatrix.value=this.normalMatrix);var n=this.program.cullFace&&this.worldMatrix.determinant()<0;this.program.use({flipFaces:n}),this.geometry.draw({mode:this.mode,program:this.program}),this.afterRenderCallbacks.forEach((function(e){return e&&e({mesh:t,camera:i})}))}}]),i}(ct),Et=new Uint8Array(4);function kt(t){return 0==(t&t-1)}var Ft=0,Tt=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=i.image,r=i.target,a=void 0===r?e.TEXTURE_2D:r,s=i.type,h=void 0===s?e.UNSIGNED_BYTE:s,u=i.format,l=void 0===u?e.RGBA:u,c=i.internalFormat,d=void 0===c?l:c,v=i.wrapS,f=void 0===v?e.CLAMP_TO_EDGE:v,g=i.wrapT,p=void 0===g?e.CLAMP_TO_EDGE:g,m=i.generateMipmaps,y=void 0===m||m,w=i.minFilter,x=void 0===w?y?e.NEAREST_MIPMAP_LINEAR:e.LINEAR:w,b=i.magFilter,M=void 0===b?e.LINEAR:b,A=i.premultiplyAlpha,E=void 0!==A&&A,k=i.unpackAlignment,F=void 0===k?4:k,T=i.flipY,_=void 0===T?a==e.TEXTURE_2D:T,R=i.level,S=void 0===R?0:R,P=i.width,C=i.height,B=void 0===C?P:C;o(this,t),this.gl=e,this.id=Ft++,this.image=n,this.target=a,this.type=h,this.format=l,this.internalFormat=d,this.minFilter=x,this.magFilter=M,this.wrapS=f,this.wrapT=p,this.generateMipmaps=y,this.premultiplyAlpha=E,this.unpackAlignment=F,this.flipY=_,this.level=S,this.width=P,this.height=B,this.texture=this.gl.createTexture(),this.store={image:null},this.glState=this.gl.renderer.state,this.state={},this.state.minFilter=this.gl.NEAREST_MIPMAP_LINEAR,this.state.magFilter=this.gl.LINEAR,this.state.wrapS=this.gl.REPEAT,this.state.wrapT=this.gl.REPEAT}return h(t,[{key:"bind",value:function(){this.glState.textureUnits[this.glState.activeTextureUnit]!==this.id&&(this.gl.bindTexture(this.target,this.texture),this.glState.textureUnits[this.glState.activeTextureUnit]=this.id)}},{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=!(this.image===this.store.image&&!this.needsUpdate);if((e||this.glState.textureUnits[t]!==this.id)&&(this.gl.renderer.activeTexture(t),this.bind()),e){if(this.needsUpdate=!1,this.flipY!==this.glState.flipY&&(this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,this.flipY),this.glState.flipY=this.flipY),this.premultiplyAlpha!==this.glState.premultiplyAlpha&&(this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),this.glState.premultiplyAlpha=this.premultiplyAlpha),this.unpackAlignment!==this.glState.unpackAlignment&&(this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,this.unpackAlignment),this.glState.unpackAlignment=this.unpackAlignment),this.minFilter!==this.state.minFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MIN_FILTER,this.minFilter),this.state.minFilter=this.minFilter),this.magFilter!==this.state.magFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MAG_FILTER,this.magFilter),this.state.magFilter=this.magFilter),this.wrapS!==this.state.wrapS&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_S,this.wrapS),this.state.wrapS=this.wrapS),this.wrapT!==this.state.wrapT&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_T,this.wrapT),this.state.wrapT=this.wrapT),this.image){if(this.image.width&&(this.width=this.image.width,this.height=this.image.height),this.target===this.gl.TEXTURE_CUBE_MAP)for(var i=0;i<6;i++)this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,this.level,this.internalFormat,this.format,this.type,this.image[i]);else ArrayBuffer.isView(this.image)?this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,this.image):this.gl.texImage2D(this.target,this.level,this.internalFormat,this.format,this.type,this.image);this.generateMipmaps&&(this.gl.renderer.isWebgl2||kt(this.image.width)&&kt(this.image.height)?this.gl.generateMipmap(this.target):(this.generateMipmaps=!1,this.wrapS=this.wrapT=this.gl.CLAMP_TO_EDGE,this.minFilter=this.gl.LINEAR))}else if(this.target===this.gl.TEXTURE_CUBE_MAP)for(var n=0;n<6;n++)this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,Et);else this.width?this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,null):this.gl.texImage2D(this.target,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,Et);this.store.image=this.image,this.onUpdate&&this.onUpdate()}}}]),t}(),_t=function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=i.width,r=void 0===n?e.canvas.width:n,a=i.height,s=void 0===a?e.canvas.height:a,h=i.target,u=void 0===h?e.FRAMEBUFFER:h,l=i.color,c=void 0===l?1:l,d=i.depth,v=void 0===d||d,f=i.stencil,g=void 0!==f&&f,p=i.depthTexture,m=void 0!==p&&p,y=i.wrapS,w=void 0===y?e.CLAMP_TO_EDGE:y,x=i.wrapT,b=void 0===x?e.CLAMP_TO_EDGE:x,M=i.minFilter,A=void 0===M?e.LINEAR:M,E=i.magFilter,k=void 0===E?A:E,F=i.type,T=void 0===F?e.UNSIGNED_BYTE:F,_=i.format,R=void 0===_?e.RGBA:_,S=i.internalFormat,P=void 0===S?R:S,C=i.unpackAlignment,B=i.premultiplyAlpha;o(this,t),this.gl=e,this.width=r,this.height=s,this.depth=v,this.buffer=this.gl.createFramebuffer(),this.target=u,this.gl.bindFramebuffer(this.target,this.buffer),this.textures=[];for(var L=[],U=0;U<c;U++)this.textures.push(new Tt(e,{width:r,height:s,wrapS:w,wrapT:b,minFilter:A,magFilter:k,type:T,format:R,internalFormat:P,unpackAlignment:C,premultiplyAlpha:B,flipY:!1,generateMipmaps:!1})),this.textures[U].update(),this.gl.framebufferTexture2D(this.target,this.gl.COLOR_ATTACHMENT0+U,this.gl.TEXTURE_2D,this.textures[U].texture,0),L.push(this.gl.COLOR_ATTACHMENT0+U);L.length>1&&this.gl.renderer.drawBuffers(L),this.texture=this.textures[0],m&&(this.gl.renderer.isWebgl2||this.gl.renderer.getExtension("WEBGL_depth_texture"))?(this.depthTexture=new Tt(e,{width:r,height:s,minFilter:this.gl.NEAREST,magFilter:this.gl.NEAREST,format:this.gl.DEPTH_COMPONENT,internalFormat:e.renderer.isWebgl2?this.gl.DEPTH_COMPONENT16:this.gl.DEPTH_COMPONENT,type:this.gl.UNSIGNED_INT}),this.depthTexture.update(),this.gl.framebufferTexture2D(this.target,this.gl.DEPTH_ATTACHMENT,this.gl.TEXTURE_2D,this.depthTexture.texture,0)):(v&&!g&&(this.depthBuffer=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.depthBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_COMPONENT16,r,s),this.gl.framebufferRenderbuffer(this.target,this.gl.DEPTH_ATTACHMENT,this.gl.RENDERBUFFER,this.depthBuffer)),g&&!v&&(this.stencilBuffer=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.stencilBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.STENCIL_INDEX8,r,s),this.gl.framebufferRenderbuffer(this.target,this.gl.STENCIL_ATTACHMENT,this.gl.RENDERBUFFER,this.stencilBuffer)),v&&g&&(this.depthStencilBuffer=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.depthStencilBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_STENCIL,r,s),this.gl.framebufferRenderbuffer(this.target,this.gl.DEPTH_STENCIL_ATTACHMENT,this.gl.RENDERBUFFER,this.depthStencilBuffer))),this.gl.bindFramebuffer(this.target,null)};function Rt(t){4===t.length&&(t=t[0]+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]);var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e||console.warn("Unable to convert hex string ".concat(t," to rgb values")),[parseInt(e[1],16)/255,parseInt(e[2],16)/255,parseInt(e[3],16)/255]}var St=function(t){l(i,t);var e=f(i);function i(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(o(this,i),"string"==typeof n){var h=Rt(n),l=a(h,3);n=l[0],r=l[1],s=l[2]}return t=e.call(this,n,r,s),c(t,u(t))}return h(i,[{key:"r",get:function(){return this[0]},set:function(t){this[0]=t}},{key:"g",get:function(){return this[1]},set:function(t){this[1]=t}},{key:"b",get:function(){return this[2]},set:function(t){this[2]=t}},{key:"set",value:function(t,e,i){if("string"==typeof t){var n=Rt(t),r=a(n,3);t=r[0],e=r[1],i=r[2]}return t.length?this.copy(t):(this[0]=t,this[1]=e,this[2]=i,this)}},{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this}}]),i}(v(Array));function Pt(t,e,i){return t[0]=e,t[1]=i,t}function Ct(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function Bt(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function Lt(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t}function Ut(t){var e=t[0],i=t[1];return Math.sqrt(e*e+i*i)}function Nt(t,e){return t[0]=-e[0],t[1]=-e[1],t}function Ot(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}var Dt=function(t){l(i,t);var e=f(i);function i(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n;return o(this,i),t=e.call(this,n,r),c(t,u(t))}return h(i,[{key:"x",get:function(){return this[0]},set:function(t){this[0]=t}},{key:"y",get:function(){return this[1]},set:function(t){this[1]=t}},{key:"set",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;return t.length?this.copy(t):(Pt(this,t,e),this)}},{key:"copy",value:function(t){var e,i;return i=t,(e=this)[0]=i[0],e[1]=i[1],this}},{key:"add",value:function(t,e){return e?Ct(this,t,e):Ct(this,this,t),this}},{key:"sub",value:function(t,e){return e?Bt(this,t,e):Bt(this,this,t),this}},{key:"multiply",value:function(t){var e,i,n;return t.length?(i=this,n=t,(e=this)[0]=i[0]*n[0],e[1]=i[1]*n[1]):Lt(this,this,t),this}},{key:"divide",value:function(t){var e,i,n;return t.length?(i=this,n=t,(e=this)[0]=i[0]/n[0],e[1]=i[1]/n[1]):Lt(this,this,1/t),this}},{key:"inverse",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;return Ot(this,t),this}},{key:"len",value:function(){return Ut(this)}},{key:"distance",value:function(t){return t?(e=this,n=(i=t)[0]-e[0],r=i[1]-e[1],Math.sqrt(n*n+r*r)):Ut(this);var e,i,n,r}},{key:"squaredLen",value:function(){return this.squaredDistance()}},{key:"squaredDistance",value:function(t){return t?(e=this,n=(i=t)[0]-e[0],r=i[1]-e[1],n*n+r*r):function(t){var e=t[0],i=t[1];return e*e+i*i}(this);var e,i,n,r}},{key:"negate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;return Nt(this,t),this}},{key:"cross",value:function(t,e){return n=e,(i=t)[0]*n[1]-i[1]*n[0];var i,n}},{key:"scale",value:function(t){return Lt(this,this,t),this}},{key:"normalize",value:function(){var t,e,i,n,r;return t=this,i=(e=this)[0],n=e[1],(r=i*i+n*n)>0&&(r=1/Math.sqrt(r)),t[0]=e[0]*r,t[1]=e[1]*r,this}},{key:"dot",value:function(t){return i=t,(e=this)[0]*i[0]+e[1]*i[1];var e,i}},{key:"equals",value:function(t){return i=t,(e=this)[0]===i[0]&&e[1]===i[1];var e,i}},{key:"applyMatrix3",value:function(t){var e,i,n,r,a;return e=this,n=t,r=(i=this)[0],a=i[1],e[0]=n[0]*r+n[3]*a+n[6],e[1]=n[1]*r+n[4]*a+n[7],this}},{key:"applyMatrix4",value:function(t){var e,i,n,r,a;return e=this,n=t,r=(i=this)[0],a=i[1],e[0]=n[0]*r+n[4]*a+n[12],e[1]=n[1]*r+n[5]*a+n[13],this}},{key:"lerp",value:function(t,e){!function(t,e,i,n){var r=e[0],a=e[1];t[0]=r+n*(i[0]-r),t[1]=a+n*(i[1]-a)}(this,this,t,e)}},{key:"clone",value:function(){return new i(this[0],this[1])}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this[0]=t[e],this[1]=t[e+1],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this[0],t[e+1]=this[1],t}}]),i}(v(Array)),It=function(t){l(i,t);var e=f(i);function i(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n;return o(this,i),t=e.call(this,n,r,a,s),c(t,u(t))}return h(i,[{key:"x",get:function(){return this[0]},set:function(t){this[0]=t}},{key:"y",get:function(){return this[1]},set:function(t){this[1]=t}},{key:"z",get:function(){return this[2]},set:function(t){this[2]=t}},{key:"w",get:function(){return this[3]},set:function(t){this[3]=t}},{key:"set",value:function(t,e,i,n){return t.length?this.copy(t):(V(this,t,e,i,n),this)}},{key:"copy",value:function(t){return q(this,t),this}},{key:"normalize",value:function(){return Y(this,this),this}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this[0]=t[e],this[1]=t[e+1],this[2]=t[e+2],this[3]=t[e+3],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t[e+3]=this[3],t}}]),i}(v(Array)),zt=function(t){l(i,t);var e=f(i);function i(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.width,a=void 0===r?1:r,s=n.height,h=void 0===s?1:s,u=n.widthSegments,l=void 0===u?1:u,c=n.heightSegments,d=void 0===c?1:c,v=n.attributes,f=void 0===v?{}:v;o(this,i);var g=l,p=d,m=(g+1)*(p+1),y=g*p*6,w=new Float32Array(3*m),x=new Float32Array(3*m),b=new Float32Array(2*m),M=m>65536?new Uint32Array(y):new Uint16Array(y);return i.buildPlane(w,x,b,M,a,h,0,g,p),Object.assign(f,{position:{size:3,data:w},normal:{size:3,data:x},uv:{size:2,data:b},index:{data:M}}),e.call(this,t,f)}return h(i,null,[{key:"buildPlane",value:function(t,e,i,n,r,a,s,o,h){for(var u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,l=arguments.length>10&&void 0!==arguments[10]?arguments[10]:1,c=arguments.length>11&&void 0!==arguments[11]?arguments[11]:2,d=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,v=arguments.length>13&&void 0!==arguments[13]?arguments[13]:-1,f=arguments.length>14&&void 0!==arguments[14]?arguments[14]:0,g=arguments.length>15&&void 0!==arguments[15]?arguments[15]:0,p=f,m=r/o,y=a/h,w=0;w<=h;w++)for(var x=w*y-a/2,b=0;b<=o;b++,f++){var M=b*m-r/2;if(t[3*f+u]=M*d,t[3*f+l]=x*v,t[3*f+c]=s/2,e[3*f+u]=0,e[3*f+l]=0,e[3*f+c]=s>=0?1:-1,i[2*f]=b/o,i[2*f+1]=1-w/h,w!==h&&b!==o){var A=p+b+w*(o+1),E=p+b+(w+1)*(o+1),k=p+b+(w+1)*(o+1)+1,F=p+b+w*(o+1)+1;n[6*g]=A,n[6*g+1]=E,n[6*g+2]=F,n[6*g+3]=E,n[6*g+4]=k,n[6*g+5]=F,g++}}}}]),i}(C),Gt=function(t){l(i,t);var e=f(i);function i(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.width,a=void 0===r?1:r,s=n.height,h=void 0===s?1:s,u=n.depth,l=void 0===u?1:u,c=n.widthSegments,d=void 0===c?1:c,v=n.heightSegments,f=void 0===v?1:v,g=n.depthSegments,p=void 0===g?1:g,m=n.attributes,y=void 0===m?{}:m;o(this,i);var w=d,x=f,b=p,M=(w+1)*(x+1)*2+(w+1)*(b+1)*2+(x+1)*(b+1)*2,A=6*(w*x*2+w*b*2+x*b*2),E=new Float32Array(3*M),k=new Float32Array(3*M),F=new Float32Array(2*M),T=M>65536?new Uint32Array(A):new Uint16Array(A),_=0,R=0;return zt.buildPlane(E,k,F,T,l,h,a,b,x,2,1,0,-1,-1,_,R),zt.buildPlane(E,k,F,T,l,h,-a,b,x,2,1,0,1,-1,_+=(b+1)*(x+1),R+=b*x),zt.buildPlane(E,k,F,T,a,l,h,b,x,0,2,1,1,1,_+=(b+1)*(x+1),R+=b*x),zt.buildPlane(E,k,F,T,a,l,-h,b,x,0,2,1,1,-1,_+=(w+1)*(b+1),R+=w*b),zt.buildPlane(E,k,F,T,a,h,-l,w,x,0,1,2,-1,-1,_+=(w+1)*(b+1),R+=w*b),zt.buildPlane(E,k,F,T,a,h,l,w,x,0,1,2,1,-1,_+=(w+1)*(x+1),R+=w*x),Object.assign(y,{position:{size:3,data:E},normal:{size:3,data:k},uv:{size:2,data:F},index:{data:T}}),e.call(this,t,y)}return i}(C),qt=function(t){l(i,t);var e=f(i);function i(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.radius,a=void 0===r?.5:r,s=n.widthSegments,h=void 0===s?16:s,u=n.heightSegments,l=void 0===u?Math.ceil(.5*h):u,c=n.phiStart,d=void 0===c?0:c,v=n.phiLength,f=void 0===v?2*Math.PI:v,g=n.thetaStart,p=void 0===g?0:g,m=n.thetaLength,y=void 0===m?Math.PI:m,w=n.attributes,x=void 0===w?{}:w;o(this,i);for(var b=h,M=l,A=d,E=f,k=p,F=y,T=(b+1)*(M+1),R=b*M*6,S=new Float32Array(3*T),P=new Float32Array(3*T),C=new Float32Array(2*T),B=T>65536?new Uint32Array(R):new Uint16Array(R),L=0,U=0,N=0,O=k+F,D=[],I=new _,z=0;z<=M;z++){for(var G=[],q=z/M,V=0;V<=b;V++,L++){var Y=V/b,X=-a*Math.cos(A+Y*E)*Math.sin(k+q*F),W=a*Math.cos(k+q*F),j=a*Math.sin(A+Y*E)*Math.sin(k+q*F);S[3*L]=X,S[3*L+1]=W,S[3*L+2]=j,I.set(X,W,j).normalize(),P[3*L]=I.x,P[3*L+1]=I.y,P[3*L+2]=I.z,C[2*L]=Y,C[2*L+1]=1-q,G.push(U++)}D.push(G)}for(var H=0;H<M;H++)for(var Z=0;Z<b;Z++){var Q=D[H][Z+1],J=D[H][Z],K=D[H+1][Z],$=D[H+1][Z+1];(0!==H||k>0)&&(B[3*N]=Q,B[3*N+1]=J,B[3*N+2]=$,N++),(H!==M-1||O<Math.PI)&&(B[3*N]=J,B[3*N+1]=K,B[3*N+2]=$,N++)}return Object.assign(x,{position:{size:3,data:S},normal:{size:3,data:P},uv:{size:2,data:C},index:{data:B}}),e.call(this,t,x)}return i}(C),Vt=function(t){l(i,t);var e=f(i);function i(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.radiusTop,a=void 0===r?.5:r,s=n.radiusBottom,h=void 0===s?.5:s,u=n.height,l=void 0===u?1:u,c=n.radialSegments,d=void 0===c?8:c,v=n.heightSegments,f=void 0===v?1:v,g=n.openEnded,p=void 0!==g&&g,m=n.thetaStart,y=void 0===m?0:m,w=n.thetaLength,x=void 0===w?2*Math.PI:w,b=n.attributes,M=void 0===b?{}:b;o(this,i);var A=d,E=f,k=y,F=x,T=p?0:h&&a?2:1,R=(A+1)*(E+1+T)+T,S=A*E*6+T*A*3,P=new Float32Array(3*R),C=new Float32Array(3*R),B=new Float32Array(2*R),L=R>65536?new Uint32Array(S):new Uint16Array(S),U=0,N=0,O=[];function D(){var t,e,i=new _,n=(h-a)/l;for(e=0;e<=E;e++){var r=[],s=e/E,o=s*(h-a)+a;for(t=0;t<=A;t++){var u=t/A,c=u*F+k,d=Math.sin(c),v=Math.cos(c);P.set([o*d,(.5-s)*l,o*v],3*U),i.set(d,n,v).normalize(),C.set([i.x,i.y,i.z],3*U),B.set([u,1-s],2*U),r.push(U++)}O.push(r)}for(t=0;t<A;t++)for(e=0;e<E;e++){var f=O[e][t],g=O[e+1][t],p=O[e+1][t+1],m=O[e][t+1];L.set([f,g,m,g,p,m],3*N),N+=2}}function I(t){var e,i=!0===t?a:h,n=!0===t?1:-1,r=U;for(P.set([0,.5*l*n,0],3*U),C.set([0,n,0],3*U),B.set([.5,.5],2*U),U++,e=0;e<=A;e++){var s=e/A*F+k,o=Math.cos(s),u=Math.sin(s);P.set([i*u,.5*l*n,i*o],3*U),C.set([0,n,0],3*U),B.set([.5*o+.5,.5*u*n+.5],2*U),U++}for(e=0;e<A;e++){var c=r+e+1;t?L.set([c,c+1,r],3*N):L.set([c+1,c,r],3*N),N++}}return D(),p||(a&&I(!0),h&&I(!1)),Object.assign(M,{position:{size:3,data:P},normal:{size:3,data:C},uv:{size:2,data:B},index:{data:L}}),e.call(this,t,M)}return i}(C),Yt=-1,Xt=0,Wt=1,jt=2,Ht=3,Zt=new _,Qt=new Dt,Jt=new Dt;var Kt=new _,$t=new _,te=new _,ee=new ot,ie=function(){function t(e){o(this,t),this.gl=e,this.origin=new _,this.direction=new _}return h(t,[{key:"castMouse",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0];t.worldMatrix.getTranslation(this.origin),this.direction.set(e[0],e[1],.5),t.unproject(this.direction),this.direction.sub(this.origin).normalize()}},{key:"intersectBounds",value:function(t){var e=this;Array.isArray(t)||(t=[t]);var i=ee,n=Kt,r=$t,a=[];return t.forEach((function(t){t.geometry.bounds||t.geometry.computeBoundingBox(),"sphere"===t.geometry.raycast&&t.geometry.bounds===1/0&&t.geometry.computeBoundingSphere(),i.inverse(t.worldMatrix),n.copy(e.origin).applyMatrix4(i),r.copy(e.direction).transformDirection(i);var s=0;(s="sphere"===t.geometry.raycast?e.intersectSphere(t.geometry.bounds,n,r):e.intersectBox(t.geometry.bounds,n,r))&&(t.hit||(t.hit={localPoint:new _}),t.hit.distance=s,t.hit.localPoint.copy(r).multiply(s).add(n),a.push(t))})),a.sort((function(t,e){return t.hit.distance-e.hit.distance})),a}},{key:"intersectSphere",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.origin,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.direction,n=te;n.sub(t.center,e);var r=n.dot(i),a=n.dot(n)-r*r,s=t.radius*t.radius;if(a>s)return 0;var o=Math.sqrt(s-a),h=r-o,u=r+o;return h<0&&u<0?0:h<0?u:h}},{key:"intersectBox",value:function(t){var e,i,n,r,a,s,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.origin,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.direction,u=1/h.x,l=1/h.y,c=1/h.z,d=t.min,v=t.max;return e=((u>=0?d.x:v.x)-o.x)*u,i=((u>=0?v.x:d.x)-o.x)*u,n=((l>=0?d.y:v.y)-o.y)*l,e>(r=((l>=0?v.y:d.y)-o.y)*l)||n>i?0:(n>e&&(e=n),r<i&&(i=r),a=((c>=0?d.z:v.z)-o.z)*c,e>(s=((c>=0?v.z:d.z)-o.z)*c)||a>i?0:(a>e&&(e=a),s<i&&(i=s),i<0?0:e>=0?e:i))}}]),t}(),ne=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=i.width,r=i.height,a=i.dpr,s=i.wrapS,h=void 0===s?e.CLAMP_TO_EDGE:s,u=i.wrapT,l=void 0===u?e.CLAMP_TO_EDGE:u,c=i.minFilter,d=void 0===c?e.LINEAR:c,v=i.magFilter,f=void 0===v?e.LINEAR:v,g=i.geometry,p=void 0===g?new C(e,{position:{size:2,data:new Float32Array([-1,-1,3,-1,-1,3])},uv:{size:2,data:new Float32Array([0,0,2,0,0,2])}}):g;o(this,t),this.gl=e,this.options={wrapS:h,wrapT:l,minFilter:d,magFilter:f},this.passes=[],this.geometry=p;var m=this.fbo={read:null,write:null,swap:function(){var t=m.read;m.read=m.write,m.write=t}};this.resize({width:n,height:r,dpr:a})}return h(t,[{key:"addPass",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.vertex,i=void 0===e?re:e,n=t.fragment,r=void 0===n?ae:n,a=t.uniforms,s=void 0===a?{}:a,o=t.textureUniform,h=void 0===o?"tMap":o,u=t.enabled,l=void 0===u||u;s[h]={value:this.fbo.read.texture};var c=new U(this.gl,{vertex:i,fragment:r,uniforms:s}),d=new At(this.gl,{geometry:this.geometry,program:c}),v={mesh:d,program:c,uniforms:s,enabled:l,textureUniform:h};return this.passes.push(v),v}},{key:"resize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.width,i=t.height,n=t.dpr;n&&(this.dpr=n),e&&(this.width=e,this.height=i||e),n=this.dpr||this.gl.renderer.dpr,e=(this.width||this.gl.renderer.width)*n,i=(this.height||this.gl.renderer.height)*n,this.options.width=e,this.options.height=i,this.fbo.read=new _t(this.gl,this.options),this.fbo.write=new _t(this.gl,this.options)}},{key:"render",value:function(t){var e=this,i=t.scene,n=t.camera,r=t.target,a=void 0===r?null:r,s=t.update,o=void 0===s||s,h=t.sort,u=void 0===h||h,l=t.frustumCull,c=void 0===l||l,d=this.passes.filter((function(t){return t.enabled}));this.gl.renderer.render({scene:i,camera:n,target:d.length?this.fbo.write:a,update:o,sort:u,frustumCull:c}),this.fbo.swap(),d.forEach((function(t,i){t.mesh.program.uniforms[t.textureUniform].value=e.fbo.read.texture,e.gl.renderer.render({scene:t.mesh,target:i===d.length-1?a:e.fbo.write,clear:!1}),e.fbo.swap()}))}}]),t}(),re="\n    attribute vec2 uv;\n    attribute vec2 position;\n\n    varying vec2 vUv;\n\n    void main() {\n        vUv = uv;\n        gl_Position = vec4(position, 0, 1);\n    }\n",ae="\n    precision highp float;\n\n    uniform sampler2D tMap;\n    varying vec2 vUv;\n\n    void main() {\n        gl_FragColor = texture2D(tMap, vUv);\n    }\n",se=new _,oe=new K,he=new _,ue=new _,le=new K,ce=new _,de=function(){function t(e){var i=e.objects,n=e.data;o(this,t),this.objects=i,this.data=n,this.elapsed=0,this.weight=1,this.duration=n.frames.length-1}return h(t,[{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1?arguments[1]:void 0,i=e?1:this.weight/t,n=this.elapsed%this.duration,r=Math.floor(n),a=n-r,s=this.data.frames[r],o=this.data.frames[(r+1)%this.duration];this.objects.forEach((function(t,e){se.fromArray(s.position,3*e),oe.fromArray(s.quaternion,4*e),he.fromArray(s.scale,3*e),ue.fromArray(o.position,3*e),le.fromArray(o.quaternion,4*e),ce.fromArray(o.scale,3*e),se.lerp(ue,a),oe.slerp(le,a),he.lerp(ce,a),t.position.lerp(se,i),t.quaternion.slerp(oe,i),t.scale.lerp(he,i)}))}}]),t}(),ve=new ot,fe=function(t){l(i,t);var e=f(i);function i(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=r.rig,s=r.geometry,h=r.program,u=r.mode,l=void 0===u?t.TRIANGLES:u;return o(this,i),(n=e.call(this,t,{geometry:s,program:h,mode:l})).createBones(a),n.createBoneTexture(),n.animations=[],Object.assign(n.program.uniforms,{boneTexture:{value:n.boneTexture},boneTextureSize:{value:n.boneTextureSize}}),n}return h(i,[{key:"createBones",value:function(t){var e=this;if(this.root=new ct,this.bones=[],t.bones&&t.bones.length){for(var i=0;i<t.bones.length;i++){var a=new ct;a.position.fromArray(t.bindPose.position,3*i),a.quaternion.fromArray(t.bindPose.quaternion,4*i),a.scale.fromArray(t.bindPose.scale,3*i),this.bones.push(a)}t.bones.forEach((function(t,i){if(e.bones[i].name=t.name,-1===t.parent)return e.bones[i].setParent(e.root);e.bones[i].setParent(e.bones[t.parent])})),this.root.updateMatrixWorld(!0),this.bones.forEach((function(t){t.bindInverse=n(ot,r(t.worldMatrix)).inverse()}))}}},{key:"createBoneTexture",value:function(){if(this.bones.length){var t=Math.max(4,Math.pow(2,Math.ceil(Math.log(Math.sqrt(4*this.bones.length))/Math.LN2)));this.boneMatrices=new Float32Array(t*t*4),this.boneTextureSize=t,this.boneTexture=new Tt(this.gl,{image:this.boneMatrices,generateMipmaps:!1,type:this.gl.FLOAT,internalFormat:this.gl.renderer.isWebgl2?this.gl.RGBA16F:this.gl.RGBA,flipY:!1,width:t})}}},{key:"addAnimation",value:function(t){var e=new de({objects:this.bones,data:t});return this.animations.push(e),e}},{key:"update",value:function(){var t=0;this.animations.forEach((function(e){return t+=e.weight})),this.animations.forEach((function(e,i){e.update(t,0===i)}))}},{key:"draw",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.camera;this.root.updateMatrixWorld(!0),this.bones.forEach((function(e,i){ve.multiply(e.worldMatrix,e.bindInverse),t.boneMatrices.set(ve,16*i)})),this.boneTexture&&(this.boneTexture.needsUpdate=!0),s(d(i.prototype),"draw",this).call(this,{camera:n})}}]),i}(At);var ge=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=i.size,r=void 0===n?128:n,a=i.falloff,s=void 0===a?.3:a,h=i.alpha,u=void 0===h?1:h,l=i.dissipation,c=void 0===l?.98:l;o(this,t);var d=this;function v(){var t=e.renderer.extensions["OES_texture_".concat(e.renderer.isWebgl2?"":"half_","float_linear")],i={width:r,height:r,type:e.renderer.isWebgl2?e.HALF_FLOAT:e.renderer.extensions.OES_texture_half_float?e.renderer.extensions.OES_texture_half_float.HALF_FLOAT_OES:e.UNSIGNED_BYTE,format:e.RGBA,internalFormat:e.renderer.isWebgl2?e.RGBA16F:e.RGBA,minFilter:t?e.LINEAR:e.NEAREST,depth:!1};d.mask.read=new _t(e,i),d.mask.write=new _t(e,i),d.mask.swap()}function f(){return new At(e,{geometry:new C(e,{position:{size:2,data:new Float32Array([-1,-1,3,-1,-1,3])},uv:{size:2,data:new Float32Array([0,0,2,0,0,2])}}),program:new U(e,{vertex:pe,fragment:me,uniforms:{tMap:d.uniform,uFalloff:{value:.5*s},uAlpha:{value:u},uDissipation:{value:c},uAspect:{value:1},uMouse:{value:d.mouse},uVelocity:{value:d.velocity}},depthTest:!1})})}this.gl=e,this.uniform={value:null},this.mask={read:null,write:null,swap:function(){var t=d.mask.read;d.mask.read=d.mask.write,d.mask.write=t,d.uniform.value=d.mask.read.texture}},v(),this.aspect=1,this.mouse=new Dt,this.velocity=new Dt,this.mesh=f()}return h(t,[{key:"update",value:function(){this.mesh.program.uniforms.uAspect.value=this.aspect,this.gl.renderer.render({scene:this.mesh,target:this.mask.write,clear:!1}),this.mask.swap()}}]),t}(),pe="\n    attribute vec2 uv;\n    attribute vec2 position;\n\n    varying vec2 vUv;\n\n    void main() {\n        vUv = uv;\n        gl_Position = vec4(position, 0, 1);\n    }\n",me="\n    precision highp float;\n\n    uniform sampler2D tMap;\n\n    uniform float uFalloff;\n    uniform float uAlpha;\n    uniform float uDissipation;\n    \n    uniform float uAspect;\n    uniform vec2 uMouse;\n    uniform vec2 uVelocity;\n\n    varying vec2 vUv;\n\n    void main() {\n        vec4 color = texture2D(tMap, vUv) * uDissipation;\n\n        vec2 cursor = vUv - uMouse;\n        cursor.x *= uAspect;\n\n        vec3 stamp = vec3(uVelocity * vec2(1, -1), 1.0 - pow(1.0 - min(1.0, length(uVelocity)), 3.0));\n        float falloff = smoothstep(uFalloff, 0.0, length(cursor)) * uAlpha;\n\n        color.rgb = mix(color.rgb, stamp, vec3(falloff));\n\n        gl_FragColor = color;\n    }\n",ye=function(){function t(e,i){var n=this,r=i.data,a=void 0===r?new Float32Array(16):r,s=i.geometry,h=void 0===s?new C(e,{position:{size:2,data:new Float32Array([-1,-1,3,-1,-1,3])},uv:{size:2,data:new Float32Array([0,0,2,0,0,2])}}):s;o(this,t),this.gl=e;var u=a;this.passes=[],this.geometry=h,this.dataLength=u.length/4,this.size=Math.pow(2,Math.ceil(Math.log(Math.ceil(Math.sqrt(this.dataLength)))/Math.LN2)),this.coords=new Float32Array(2*this.dataLength);for(var l=0;l<this.dataLength;l++){var c=l%this.size/this.size,d=Math.floor(l/this.size)/this.size;this.coords.set([c,d],2*l)}var v=function(){if(u.length===n.size*n.size*4)return u;var t=new Float32Array(n.size*n.size*4);return t.set(u),t}();this.uniform={value:new Tt(e,{image:v,target:e.TEXTURE_2D,type:e.FLOAT,format:e.RGBA,internalFormat:e.renderer.isWebgl2?e.RGBA32F:e.RGBA,wrapS:e.CLAMP_TO_EDGE,wrapT:e.CLAMP_TO_EDGE,generateMipmaps:!1,minFilter:e.NEAREST,magFilter:e.NEAREST,width:this.size,flipY:!1})};var f={width:this.size,height:this.size,type:e.renderer.isWebgl2?e.HALF_FLOAT:e.renderer.extensions.OES_texture_half_float?e.renderer.extensions.OES_texture_half_float.HALF_FLOAT_OES:e.UNSIGNED_BYTE,format:e.RGBA,internalFormat:e.renderer.isWebgl2?e.RGBA16F:e.RGBA,minFilter:e.NEAREST,depth:!1,unpackAlignment:1};this.fbo={read:new _t(e,f),write:new _t(e,f),swap:function(){var t=n.fbo.read;n.fbo.read=n.fbo.write,n.fbo.write=t,n.uniform.value=n.fbo.read.texture}}}return h(t,[{key:"addPass",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.vertex,i=void 0===e?we:e,n=t.fragment,r=void 0===n?xe:n,a=t.uniforms,s=void 0===a?{}:a,o=t.textureUniform,h=void 0===o?"tMap":o,u=t.enabled,l=void 0===u||u;s[h]=this.uniform;var c=new U(this.gl,{vertex:i,fragment:r,uniforms:s}),d=new At(this.gl,{geometry:this.geometry,program:c}),v={mesh:d,program:c,uniforms:s,enabled:l,textureUniform:h};return this.passes.push(v),v}},{key:"render",value:function(){var t=this;this.passes.filter((function(t){return t.enabled})).forEach((function(e,i){t.gl.renderer.render({scene:e.mesh,target:t.fbo.write,clear:!1}),t.fbo.swap()}))}}]),t}(),we="\n    attribute vec2 uv;\n    attribute vec2 position;\n\n    varying vec2 vUv;\n\n    void main() {\n        vUv = uv;\n        gl_Position = vec4(position, 0, 1);\n    }\n",xe="\n    precision highp float;\n\n    uniform sampler2D tMap;\n    varying vec2 vUv;\n\n    void main() {\n        gl_FragColor = texture2D(tMap, vUv);\n    }\n",be=new _,Me=function(){function t(e,i){var n=i.points,r=i.vertex,a=void 0===r?Ae:r,s=i.fragment,h=void 0===s?Ee:s,u=i.uniforms,l=void 0===u?{}:u,c=i.attributes,d=void 0===c?{}:c;o(this,t),this.gl=e,this.points=n,this.count=n.length,this.position=new Float32Array(3*this.count*2),this.prev=new Float32Array(3*this.count*2),this.next=new Float32Array(3*this.count*2);for(var v=new Float32Array(1*this.count*2),f=new Float32Array(2*this.count*2),g=new Uint16Array(3*(this.count-1)*2),p=0;p<this.count;p++){v.set([-1,1],2*p);var m=p/(this.count-1);if(f.set([0,m,1,m],4*p),p!==this.count-1){var y=2*p;g.set([y+0,y+1,y+2],3*(y+0)),g.set([y+2,y+1,y+3],3*(y+1))}}var w=this.geometry=new C(e,Object.assign(d,{position:{size:3,data:this.position},prev:{size:3,data:this.prev},next:{size:3,data:this.next},side:{size:1,data:v},uv:{size:2,data:f},index:{size:1,data:g}}));this.updateGeometry(),l.uResolution||(this.resolution=l.uResolution={value:new Dt}),l.uDPR||(this.dpr=l.uDPR={value:1}),l.uThickness||(this.thickness=l.uThickness={value:1}),l.uColor||(this.color=l.uColor={value:new St("#000")}),l.uMiter||(this.miter=l.uMiter={value:1}),this.resize();var x=this.program=new U(e,{vertex:a,fragment:h,uniforms:l});this.mesh=new At(e,{geometry:w,program:x})}return h(t,[{key:"updateGeometry",value:function(){var t=this;this.points.forEach((function(e,i){e.toArray(t.position,3*i*2),e.toArray(t.position,3*i*2+3),i?(e.toArray(t.next,3*(i-1)*2),e.toArray(t.next,3*(i-1)*2+3)):(be.copy(e).sub(t.points[i+1]).add(e),be.toArray(t.prev,3*i*2),be.toArray(t.prev,3*i*2+3)),i===t.points.length-1?(be.copy(e).sub(t.points[i-1]).add(e),be.toArray(t.next,3*i*2),be.toArray(t.next,3*i*2+3)):(e.toArray(t.prev,3*(i+1)*2),e.toArray(t.prev,3*(i+1)*2+3))})),this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.prev.needsUpdate=!0,this.geometry.attributes.next.needsUpdate=!0}},{key:"resize",value:function(){this.resolution&&this.resolution.value.set(this.gl.canvas.width,this.gl.canvas.height),this.dpr&&(this.dpr.value=this.gl.renderer.dpr)}}]),t}(),Ae="\n    precision highp float;\n\n    attribute vec3 position;\n    attribute vec3 next;\n    attribute vec3 prev;\n    attribute vec2 uv;\n    attribute float side;\n\n    uniform mat4 modelViewMatrix;\n    uniform mat4 projectionMatrix;\n    uniform vec2 uResolution;\n    uniform float uDPR;\n    uniform float uThickness;\n    uniform float uMiter;\n\n    varying vec2 vUv;\n\n    vec4 getPosition() {\n        mat4 mvp = projectionMatrix * modelViewMatrix;\n        vec4 current = mvp * vec4(position, 1);\n        vec4 nextPos = mvp * vec4(next, 1);\n        vec4 prevPos = mvp * vec4(prev, 1);\n\n        vec2 aspect = vec2(uResolution.x / uResolution.y, 1);    \n        vec2 currentScreen = current.xy / current.w * aspect;\n        vec2 nextScreen = nextPos.xy / nextPos.w * aspect;\n        vec2 prevScreen = prevPos.xy / prevPos.w * aspect;\n    \n        vec2 dir1 = normalize(currentScreen - prevScreen);\n        vec2 dir2 = normalize(nextScreen - currentScreen);\n        vec2 dir = normalize(dir1 + dir2);\n    \n        vec2 normal = vec2(-dir.y, dir.x);\n        normal /= mix(1.0, max(0.3, dot(normal, vec2(-dir1.y, dir1.x))), uMiter);\n        normal /= aspect;\n\n        float pixelWidthRatio = 1.0 / (uResolution.y / uDPR);\n        float pixelWidth = current.w * pixelWidthRatio;\n        normal *= pixelWidth * uThickness;\n        current.xy -= normal * side;\n    \n        return current;\n    }\n\n    void main() {\n        vUv = uv;\n        gl_Position = getPosition();\n    }\n",Ee="\n    precision highp float;\n\n    uniform vec3 uColor;\n    \n    varying vec2 vUv;\n\n    void main() {\n        gl_FragColor.rgb = uColor;\n        gl_FragColor.a = 1.0;\n    }\n",ke=function(){function t(e,i){var n=i.light,r=void 0===n?new gt(e):n,a=i.width,s=void 0===a?1024:a,h=i.height,u=void 0===h?s:h;o(this,t),this.gl=e,this.light=r,this.target=new _t(e,{width:s,height:u}),this.depthProgram=new U(e,{vertex:Fe,fragment:Te,cullFace:null}),this.castMeshes=[]}return h(t,[{key:"add",value:function(t){var e=t.mesh,i=t.receive,n=void 0===i||i,r=t.cast,a=void 0===r||r,s=t.vertex,o=void 0===s?Fe:s,h=t.fragment,u=void 0===h?Te:h,l=t.uniformProjection,c=void 0===l?"shadowProjectionMatrix":l,d=t.uniformView,v=void 0===d?"shadowViewMatrix":d,f=t.uniformTexture,g=void 0===f?"tShadow":f;n&&!e.program.uniforms[c]&&(e.program.uniforms[c]={value:this.light.projectionMatrix},e.program.uniforms[v]={value:this.light.viewMatrix},e.program.uniforms[g]={value:this.target.texture}),a&&(this.castMeshes.push(e),e.colorProgram=e.program,e.depthProgram||(e.depthProgram=o!==Fe||u!==Te?new U(gl,{vertex:o,fragment:u,cullFace:null}):this.depthProgram))}},{key:"render",value:function(t){var e=this,i=t.scene;i.traverse((function(t){t.draw&&(~e.castMeshes.indexOf(t)?t.program=t.depthProgram:(t.visible&&(t.isForceVisibility=!0),t.visible=!1))})),this.gl.renderer.render({scene:i,camera:this.light,target:this.target}),i.traverse((function(t){t.draw&&(~e.castMeshes.indexOf(t)?t.program=t.colorProgram:t.isForceVisibility&&(t.visible=!0))}))}}]),t}(),Fe="\n    attribute vec3 position;\n    attribute vec2 uv;\n\n    uniform mat4 modelViewMatrix;\n    uniform mat4 projectionMatrix;\n\n    void main() {\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    }\n",Te="\n    precision highp float;\n\n    vec4 packRGBA (float v) {\n        vec4 pack = fract(vec4(1.0, 255.0, 65025.0, 16581375.0) * v);\n        pack -= pack.yzww * vec2(1.0 / 255.0, 0.0).xxxy;\n        return pack;\n    }\n\n    void main() {\n        gl_FragColor = packRGBA(gl_FragCoord.z);\n    }\n";e.Animation=de,e.Box=Gt,e.Camera=gt,e.Color=St,e.Cylinder=Vt,e.Euler=lt,e.Flowmap=ge,e.GPGPU=ye,e.Geometry=C,e.Mat3=bt,e.Mat4=ot,e.Mesh=At,e.NormalProgram=function(t){return new U(t,{vertex:"\n    precision highp float;\n    precision highp int;\n\n    attribute vec3 position;\n    attribute vec3 normal;\n\n    uniform mat3 normalMatrix;\n    uniform mat4 modelViewMatrix;\n    uniform mat4 projectionMatrix;\n\n    varying vec3 vNormal;\n\n    void main() {\n        vNormal = normalize(normalMatrix * normal);\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    }\n",fragment:"\n    precision highp float;\n    precision highp int;\n\n    varying vec3 vNormal;\n\n    void main() {\n        gl_FragColor.rgb = normalize(vNormal);\n        gl_FragColor.a = 1.0;\n    }\n"})},e.Orbit=function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=i.element,r=void 0===n?document:n,a=i.enabled,s=void 0===a||a,o=i.target,h=void 0===o?new _:o,u=i.ease,l=void 0===u?.25:u,c=i.inertia,d=void 0===c?.85:c,v=i.enableRotate,f=void 0===v||v,g=i.rotateSpeed,p=void 0===g?.1:g,m=i.enableZoom,y=void 0===m||m,w=i.zoomSpeed,x=void 0===w?1:w,b=i.enablePan,M=void 0===b||b,A=i.panSpeed,E=void 0===A?.1:A,k=i.minPolarAngle,F=void 0===k?0:k,T=i.maxPolarAngle,R=void 0===T?Math.PI:T,S=i.minAzimuthAngle,P=void 0===S?-1/0:S,C=i.maxAzimuthAngle,B=void 0===C?1/0:C,L=i.minDistance,U=void 0===L?0:L,N=i.maxDistance,O=void 0===N?1/0:N;this.enabled=s,this.target=h,l=l||1,d=d||1,this.minDistance=U,this.maxDistance=O;var D={radius:1,phi:0,theta:0},I={radius:1,phi:0,theta:0},z={radius:1,phi:0,theta:0},G=new _,q=new _;q.copy(t.position).sub(this.target),z.radius=I.radius=q.distance(),z.theta=I.theta=Math.atan2(q.x,q.z),z.phi=I.phi=Math.acos(Math.min(Math.max(q.y/I.radius,-1),1)),this.update=function(){I.radius*=D.radius,I.theta+=D.theta,I.phi+=D.phi,I.theta=Math.max(P,Math.min(B,I.theta)),I.phi=Math.max(F,Math.min(R,I.phi)),I.radius=Math.max(e.minDistance,Math.min(e.maxDistance,I.radius)),z.phi+=(I.phi-z.phi)*l,z.theta+=(I.theta-z.theta)*l,z.radius+=(I.radius-z.radius)*l,e.target.add(G);var i=z.radius*Math.sin(Math.max(1e-6,z.phi));q.x=i*Math.sin(z.theta),q.y=z.radius*Math.cos(z.phi),q.z=i*Math.cos(z.theta),t.position.copy(e.target).add(q),t.lookAt(e.target),D.theta*=d,D.phi*=d,G.multiply(d),D.radius=1};var V=new Dt,Y=new Dt,X=new Dt,W=Yt;function j(){return Math.pow(.95,x)}function H(t,e){Zt.set(e[0],e[1],e[2]),Zt.multiply(-t),G.add(Zt)}function Z(t,e){Zt.set(e[4],e[5],e[6]),Zt.multiply(t),G.add(Zt)}this.mouseButtons={ORBIT:0,ZOOM:1,PAN:2};var Q=function(i,n){var a=r===document?document.body:r;Zt.copy(t.position).sub(e.target);var s=Zt.distance();H(2*i*(s*=Math.tan((t.fov||45)/2*Math.PI/180))/a.clientHeight,t.matrix),Z(2*n*s/a.clientHeight,t.matrix)};function J(t){D.radius/=t}function K(t,e){Qt.set(t,e),Jt.sub(Qt,V).multiply(p);var i=r===document?document.body:r;D.theta-=2*Math.PI*Jt.x/i.clientHeight,D.phi-=2*Math.PI*Jt.y/i.clientHeight,V.copy(Qt)}function $(t){Qt.set(t.clientX,t.clientY),Jt.sub(Qt,X),Jt.y>0?J(j()):Jt.y<0&&J(1/j()),X.copy(Qt)}function tt(t,e){Qt.set(t,e),Jt.sub(Qt,Y).multiply(E),Q(Jt.x,Jt.y),Y.copy(Qt)}function et(t){if(y){var e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY,n=Math.sqrt(e*e+i*i);X.set(0,n)}if(M){var r=.5*(t.touches[0].pageX+t.touches[1].pageX),a=.5*(t.touches[0].pageY+t.touches[1].pageY);Y.set(r,a)}}function it(t){if(y){var e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY,n=Math.sqrt(e*e+i*i);Qt.set(0,n),Jt.set(0,Math.pow(Qt.y/X.y,x)),J(Jt.y),X.copy(Qt)}M&&tt(.5*(t.touches[0].pageX+t.touches[1].pageX),.5*(t.touches[0].pageY+t.touches[1].pageY))}var nt=function(t){if(e.enabled){switch(t.button){case e.mouseButtons.ORBIT:if(!1===f)return;V.set(t.clientX,t.clientY),W=Xt;break;case e.mouseButtons.ZOOM:if(!1===y)return;X.set(t.clientX,t.clientY),W=Wt;break;case e.mouseButtons.PAN:if(!1===M)return;Y.set(t.clientX,t.clientY),W=jt}W!==Yt&&(window.addEventListener("mousemove",rt,!1),window.addEventListener("mouseup",at,!1))}},rt=function(t){if(e.enabled)switch(W){case Xt:if(!1===f)return;K(t.clientX,t.clientY);break;case Wt:if(!1===y)return;$(t);break;case jt:if(!1===M)return;tt(t.clientX,t.clientY)}},at=function t(){e.enabled&&(document.removeEventListener("mousemove",rt,!1),document.removeEventListener("mouseup",t,!1),W=Yt)},st=function(t){e.enabled&&y&&(W===Yt||W===Xt)&&(t.stopPropagation(),t.deltaY<0?J(1/j()):t.deltaY>0&&J(j()))},ot=function(t){if(e.enabled)switch(t.preventDefault(),t.touches.length){case 1:if(!1===f)return;V.set(t.touches[0].pageX,t.touches[0].pageY),W=Xt;break;case 2:if(!1===y&&!1===M)return;et(t),W=Ht;break;default:W=Yt}},ht=function(t){if(e.enabled)switch(t.preventDefault(),t.stopPropagation(),t.touches.length){case 1:if(!1===f)return;K(t.touches[0].pageX,t.touches[0].pageY);break;case 2:if(!1===y&&!1===M)return;it(t);break;default:W=Yt}},ut=function(){e.enabled&&(W=Yt)},lt=function(t){e.enabled&&t.preventDefault()};function ct(){r.addEventListener("contextmenu",lt,!1),r.addEventListener("mousedown",nt,!1),window.addEventListener("wheel",st,!1),r.addEventListener("touchstart",ot,{passive:!1}),r.addEventListener("touchend",ut,!1),r.addEventListener("touchmove",ht,{passive:!1})}this.remove=function(){r.removeEventListener("contextmenu",lt,!1),r.removeEventListener("mousedown",nt,!1),window.removeEventListener("wheel",st,!1),r.removeEventListener("touchstart",ot,!1),r.removeEventListener("touchend",ut,!1),r.removeEventListener("touchmove",ht,!1),window.removeEventListener("mousemove",rt,!1),window.removeEventListener("mouseup",at,!1)},ct()},e.Plane=zt,e.Polyline=Me,e.Post=ne,e.Program=U,e.Quat=K,e.Raycast=ie,e.RenderTarget=_t,e.Renderer=G,e.Shadow=ke,e.Skin=fe,e.Sphere=qt,e.Text=function(t){var e,i,n,r,a=t.font,s=t.text,o=t.width,h=void 0===o?1/0:o,u=t.align,l=void 0===u?"left":u,c=t.size,d=void 0===c?1:c,v=t.letterSpacing,f=void 0===v?0:v,g=t.lineHeight,p=void 0===g?1.4:g,m=t.wordSpacing,y=void 0===m?0:m,w=t.wordBreak,x=void 0!==w&&w,b=this,M=/\n/,A=/\s/;function E(){a.common.lineHeight,n=a.common.base,r=d/n;var t=s.replace(/[ \n]/g,"").length;i={position:new Float32Array(4*t*3),uv:new Float32Array(4*t*2),id:new Float32Array(4*t),index:new Uint16Array(6*t)};for(var e=0;e<t;e++)i.id[e]=e,i.index.set([4*e,4*e+2,4*e+1,4*e+1,4*e+2,4*e+3],6*e);k()}function k(){var t=[],n=0,o=0,u=0,c=v();function v(){var e={width:0,glyphs:[]};return t.push(e),o=n,u=0,e}for(var g=0;n<s.length&&g<100;){g++;var m=s[n];if(c.width||!A.test(m))if(M.test(m))n++,c=v();else{var w=e[m];if(c.glyphs.length){var E=c.glyphs[c.glyphs.length-1][0],k=F(w.id,E.id)*r;c.width+=k,u+=k}c.glyphs.push([w,c.width]);var T=0;if(A.test(m)?(o=n,u=0,T+=y*d):T+=f*d,T+=w.xadvance*r,c.width+=T,u+=T,c.width>h){if(x&&c.glyphs.length>1){c.width-=T,c.glyphs.pop(),c=v();continue}if(!x&&u!==c.width){var _=n-o+1;c.glyphs.splice(-_,_),n=o,c.width-=u,c=v();continue}}n++}else n++,o=n,u=0}c.width||t.pop(),function(t){for(var e=a.common.scaleW,n=a.common.scaleH,s=.07*d,o=0,h=0;h<t.length;h++){for(var u=t[h],c=0;c<u.glyphs.length;c++){var v=u.glyphs[c][0],f=u.glyphs[c][1];if("center"===l?f-=.5*u.width:"right"===l&&(f-=u.width),!A.test(v.char)){f+=v.xoffset*r,s-=v.yoffset*r;var g=v.width*r,m=v.height*r;i.position.set([f,s-m,0,f,s,0,f+g,s-m,0,f+g,s,0],4*o*3);var y=v.x/e,w=v.width/e,x=1-v.y/n,M=v.height/n;i.uv.set([y,x-M,y,x,y+w,x-M,y+w,x],4*o*2),s+=v.yoffset*r,o++}}s-=d*p}b.buffers=i,b.numLines=t.length,b.height=b.numLines*d*p}(t)}function F(t,e){for(var i=0;i<a.kernings.length;i++){var n=a.kernings[i];if(!(n.first<t)&&!(n.second<e))return n.first>t||n.first===t&&n.second>e?0:n.amount}return 0}e={},a.chars.forEach((function(t){return e[t.char]=t})),E(),this.resize=function(t){h=t.width,k()},this.update=function(t){s=t.text,E()}},e.Texture=Tt,e.Transform=ct,e.Vec2=Dt,e.Vec3=_,e.Vec4=It}}]);
//# sourceMappingURL=7bfda8e4-05d140e8a9a53b5b4d54.js.map